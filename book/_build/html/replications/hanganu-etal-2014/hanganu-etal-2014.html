
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Replication: Hanganu et al., 2014 &#8212; LivingPark Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'replications/hanganu-etal-2014/hanganu-etal-2014';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Replication of [E. Mak et al., 2015]" href="../mak-etal-2015/README.html" />
    <link rel="prev" title="Replication of [A. Hanganu et al., 2014]" href="README.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="LivingPark Book - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="LivingPark Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    LivingPark
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">A note on Reproducibility vs. Replicability</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../technical_challenges.html">Data Usage Agreement</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reproducibility studies (Harmonization [WIP])</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../agosta-etal-2013/README.html">F. Agosta et al., 2013</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../agosta-etal-2013/agosta-etal.html">Replication</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="README.html">A. Hanganu et al., 2014</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Replication: Hanganu <em>et al.</em>, 2014</a></li>














</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mak-etal-2015/README.html">E. Mak et al., 2015</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../mak-etal-2015/mak-etal-2015.html">Mak et al, 2015</a></li>



</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mak-etal-2017/README.html">E. Mak et al., 2017</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../mak-etal-2017/cohort_definition.html">Replication: Mak et al., 2017</a></li>



<li class="toctree-l2"><a class="reference internal" href="../mak-etal-2017/fsl_siena.html">Failed DICOM to NIfTI conversion</a></li>

<li class="toctree-l2"><a class="reference internal" href="../mak-etal-2017/stat_analysis.html">Comparisons of percentage brain volume change and ventricular enlargement</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../rahayel-etal-2018/README.html">S. Rahayel et al., 2018</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../rahayel-etal-2018/rahayel-etal-2018.html">Replication</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../scherfler-etal-2011/README.html">C. Scherfler et al., 2011</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../scherfler-etal-2011/scherfler-etal.html">Replication</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shu-etal-2021/README.html">Z. Shu et al., 2021</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../shu-etal-2021/shu-etal.html">Replication: Shu <em>et al</em>, 2020</a></li>




</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../sterling-etal-2016/README.html">N. W. Sterling et al., 2016</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../sterling-etal-2016/sterling-etal-2016.html">Replication</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tessa-etal-2014/README.html">C. Tessa et al., 2014</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../tessa-etal-2014/Replication%20-%20%20Tessa%20et%20al.%202014.html">Introduction</a></li>






</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../zeighami-etal-2015/README.html">Y. Zeighami et al., 2015</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../zeighami-etal-2015/Yashar%20et.%20al%202015.html">Replication</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../zeighami-etal-2019/README.html">Y. Zeighami et al., 2019</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../zeighami-etal-2019/zeighami-etal-2019.html">Replication</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Utility packages</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../packages/ppmi_downloader.html">PPMI_Downloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../packages/livingpark_utils.html">LivingPark_Utils</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About LivingPark</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://github.com/LivingPark-MRI/">Organization repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cite.html">Cite</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/LivingPark-MRI/livingpark-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/LivingPark-MRI/livingpark-book/issues/new?title=Issue%20on%20page%20%2Freplications/hanganu-etal-2014/hanganu-etal-2014.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/replications/hanganu-etal-2014/hanganu-etal-2014.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Replication: Hanganu et al., 2014</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Replication: Hanganu <em>et al.</em>, 2014</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-setup">Initial setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ppmi-cohort-preparation">PPMI cohort preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#study-data-download">Study data download</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criteria">Inclusion criteria</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exclusion-criteria">Exclusion criteria</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#group-matching">Group matching</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-aggregation">Data aggregation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pair-visits">Pair visits</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#select-healthy-controls">Select healthy controls</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-aggregation-for-pd">Data aggregation for PD</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-available-visit-pairs-pd-meeting-all-the-criteria">Number of available visit pairs - PD meeting all the criteria</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#select-pd-mci-patients">Select PD-MCI patients</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#select-pd-non-mci-patients">Select PD-non-MCI patients</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Group matching</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-statistics">Descriptive statistics</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#get-mri-data">Get MRI data</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#image-preprocessing">Image preprocessing</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-pipeline-by-hanganu-et-al">Preprocessing pipeline by Hanganu et al.</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-step-1-cross-sectional">preprocessing step 1 - cross-sectional</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-step-2-base-template">preprocessing step 2 - base template</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-step-3-longitudinally-processed-timepoints">preprocessing step 3 - longitudinally processed timepoints</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-step-4-qcache">preprocessing step 4 - Qcache</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#image-quality-control">Image quality control</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#axial">Axial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coronal">Coronal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sagittal">Sagittal</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#postprocessing">Postprocessing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#roi-analysis">ROI analysis</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vertex-wise-analysis">Vertex-wise analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-the-vertex-data-with-long-mris-slopes-for-longitudinal-two-stage-model">Prepare the vertex data with long_mris_slopes for longitudinal two stage model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-fsgd-file-for-the-correlational-analysis">Create FSGD file for the correlational analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stack-images-for-correlational-analyses">Stack images for correlational analyses</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-fsgd-file-for-the-group-analysis">Create FSGD file for the group analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stack-images-for-group-analyses">Stack images for group analyses</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-glm-model-for-the-correlational-analysis">Run GLM model for the correlational analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-glm-model-for-the-group-analysis">Run GLM model for the group analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#correction-for-multiple-comparison-with-mri-glmfit-sim">Correction for multiple comparison (with mri_glmfit-sim)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vertex-wise-results">Vertex-wise results</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation-with-moca">correlation with MoCA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#group-differences">group differences</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rate-of-change-of-cortical-thickness-in-patients-with-parkinsons-disease">Rate of change of cortical thickness in patients with Parkinson’s disease.</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="replication-hanganu-et-al-2014">
<h1>Replication: Hanganu <em>et al.</em>, 2014<a class="headerlink" href="#replication-hanganu-et-al-2014" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This notebook attemps to replicate the following paper with the PPMI dataset:</p>
<p>A. Hanganu et al. <a href=https://academic.oup.com/brain/article/137/4/1120/372146> “Mild cognitive impairment is linked with faster rate of cortical thinning in patients with Parkinson’s disease longitudinally”</a> Brain, vol. 137, no. 4, pp. 1120–1129, 2014.</p>
<p>Abbreviations:</p>
<p>GMV - gray matter volume <br>
HC- healthy controls <br>
MCI - mild cognitive impairement <br>
MoCA - Montreal Cognitive Assessement <br>
PD-MCI - Parkinson’s disease with MCI <br>
PD-non-MCI - Parkinson’s disease without MCI</p>
<p>This study involved 17 PD-MCI patients, 15 PD-non-MCI patients, and 18 HC. The demografic parameters were as follows (table extracted from the paper):</p>
<img src="images/demographics.png"/>
Table extracted from the paper A. Hanganu et al. <a href=https://academic.oup.com/brain/article/137/4/1120/372146> “Mild cognitive impairment is linked with faster rate of cortical thinning in patients with Parkinson’s disease longitudinally”</a> Brain, vol. 137, no. 4, pp. 1120–1129, 2014.
<p>The main results of the paper can be divided into three sections:</p>
<ol class="arabic simple">
<li><p><strong>Difference in changes of cortical thickness between groups</strong></p>
<ul class="simple">
<li><p><strong>PD-MCI</strong> showed increased rate of overall cortical thinning compared with both PD-non-MCI and HC (Table 2).</p>
<ul>
<li><p><strong>PD-MCI vs PD-non-MCI</strong>: increased thinning was detected in the right temporal lobe (middle temporal gyrus, transverse temporal gyrus, temporal pole), the right insula, right inferior frontal gyrus and the right supplementary motor area (Figure 1).</p></li>
<li><p><strong>PD-MCI vs HC</strong>: increased thinning was again detected in the right temporal lobe and right supplementary motor area. Additional significant clusters included the bilateral precuneus, bi- lateral cuneus, bilateral lingual, as well as right inferior parietal, right lateral occipital and left orbitofrontal region (Figure 1).</p></li>
<li><p><strong>PD-non-MCI vs HC</strong>: an increased rate of thinning only in the left lateral occipital and left fusiform regions (Figure 1).</p></li>
</ul>
</li>
</ul>
</li>
</ol>
<img src="images/org_results_figure_1.png"/> 
<img src="images/org_results_table_2.png"/>
Figures extracted from the paper A. Hanganu et al. <a href=https://academic.oup.com/brain/article/137/4/1120/372146> “Mild cognitive impairment is linked with faster rate of cortical thinning in patients with Parkinson’s disease longitudinally”</a> Brain, vol. 137, no. 4, pp. 1120–1129, 2014.
<ol class="arabic simple" start="2">
<li><p><strong>Correlation between change of cortical thickness and MoCA</strong></p>
<ul class="simple">
<li><p>a positive correlation between rate of change of cortical thickness and MoCA scores was observed when considering all of the patients with Parkinson’s disease (All-PD group), which was driven by the PD-MCI group. Significant clusters were revealed in the temporal lobe bilaterally, the right occipital medial lobe and the left postcentral gyrus. Clusters of negative correlation were revealed in the anterior cingulate region in the All Parkinson’s disease group and in the transverse temporal gyrus in PD-MCI (Figure 2).</p></li>
</ul>
</li>
</ol>
<img src="images/org_results_figure_2.png"/>
Figure extracted from the paper A. Hanganu et al. <a href=https://academic.oup.com/brain/article/137/4/1120/372146> “Mild cognitive impairment is linked with faster rate of cortical thinning in patients with Parkinson’s disease longitudinally”</a> Brain, vol. 137, no. 4, pp. 1120–1129, 2014.
<ol class="arabic simple" start="3">
<li><p><strong>Differences in change of subcortical volume between groups</strong></p>
<ul class="simple">
<li><p>decreased volumes in both Parkinson’s disease groups of the thalamus, caudate nucleus, putamen and hippocampus.</p></li>
<li><p>a significant decrease in volume of the amygdala and nucleus accumbens was observed in the PD-MCI group vs both PD-non-MCI and HC (Table 2). ## note that this information is not consistent with Table 2. MD-MCI vs PD-non-MCI is significant only for Amyg</p></li>
</ul>
</li>
<li><p><strong>Correlation between subcortical volume differences and MoCA</strong></p>
<ul class="simple">
<li><p>a significant correlation between change of cognition over time and change of amygdala volume was identified in the All Parkinson’s disease group, and this was driven by the near-significant result observed in the Parkinson’s disease with MCI group (P = 0.059). Additionally both the Parkinson’s disease with MCI and All Parkinson’s disease groups revealed a correlation between cognition and the volume of the thalamus (Table 3).</p></li>
</ul>
</li>
</ol>
<img src="images/org_results_table_3.png"/>
Figure extracted from the paper A. Hanganu et al. <a href=https://academic.oup.com/brain/article/137/4/1120/372146> “Mild cognitive impairment is linked with faster rate of cortical thinning in patients with Parkinson’s disease longitudinally”</a> Brain, vol. 137, no. 4, pp. 1120–1129, 2014.
<p>The remainder of this notebook is an attempt to replicate this result using the PPMI dataset.</p>
</section>
<section id="initial-setup">
<h2>Initial setup<a class="headerlink" href="#initial-setup" title="Link to this heading">#</a></h2>
<!-- LivingPark notebooks use a *cache* directory to store analysis inputs and outputs. Inputs typically include PPMI Study Data and imaging data whereas outputs include processed images and other derivatives. Cache directories allow LivingPark notebooks to run in a few minutes as they reuse previously computed results. However, cache directories cannot be made public due to the PPMI Data Usage Agreement (DUA). Instead, they are stored on `login.bic.mni.mcgill.ca`, which requires a specific user name and password. In case you don't have access to the cache directory of this notebook, the next sections will download all the required imaging data from PPMI and recompute the results, which will take a few hours depending on your computer configuration. In the future, we will aim at storing this cache dataset on PPMI servers so that they can be accessed with a PPMI account. -->
<p>Let’s initialize the notebook directory and software dependencies:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">livingpark_utils</span>

<span class="n">utils</span> <span class="o">=</span> <span class="n">livingpark_utils</span><span class="o">.</span><span class="n">LivingParkUtils</span><span class="p">()</span>
<span class="n">random_seed</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">utils</span><span class="o">.</span><span class="n">notebook_init</span><span class="p">()</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This notebook was run on 2023-02-27 17:48:03 UTC +0000
</pre></div>
</div>
</div>
</div>
</section>
<section id="ppmi-cohort-preparation">
<h2>PPMI cohort preparation<a class="headerlink" href="#ppmi-cohort-preparation" title="Link to this heading">#</a></h2>
<p>We will build a PPMI cohort that matches the one used in the original study (Table 1) as much as possible. As in other LivingPark replications, we will use the same sample size as the original study. Our cohort will be built directly from PPMI Study Data files so that it can be replicated and updated whenever necessary.</p>
<section id="study-data-download">
<h3>Study data download<a class="headerlink" href="#study-data-download" title="Link to this heading">#</a></h3>
<p>We will start by downloading the PPMI Study Data files required to build our cohort:</p>
<ul class="simple">
<li><p>demographics</p></li>
<li><p>disease duration</p></li>
<li><p>Montreal Cognitive Assessment</p></li>
<li><p>UPDRS</p></li>
<li><p>Hoehn and Yahr score</p></li>
<li><p>primary clinical diagnosis</p></li>
<li><p>cognitive categorization</p></li>
<li><p>medical condition</p></li>
</ul>
<p>We will use the LivingPark utils library to download these files from the notebook. If files are already present in the notebook cache, they won’t be downloaded again. Otherwise, you will need to enter your PPMI username and password. <strong>In case you don’t have a PPMI account, you can request one <a class="reference external" href="http://ppmi-info.org">here</a>.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">livingpark_utils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">livingpark_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">download</span>

<span class="n">utils</span> <span class="o">=</span> <span class="n">livingpark_utils</span><span class="o">.</span><span class="n">LivingParkUtils</span><span class="p">()</span>
<span class="n">downloader</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">ppmi</span><span class="o">.</span><span class="n">Downloader</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">)</span>

<span class="n">required_files</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Demographics.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Age_at_visit.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Primary_Clinical_Diagnosis.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Cognitive_Categorization.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Medical_Conditions_Log.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Concomitant_Medication_Log.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MDS-UPDRS_Part_III.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Participant_Status.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Socio-Economics.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Montreal_Cognitive_Assessment__MoCA_.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PD_Diagnosis_History.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LEDD_Concomitant_Medication_Log.csv&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">utils</span><span class="o">.</span><span class="n">notebook_init</span><span class="p">()</span>
<span class="n">utils</span><span class="o">.</span><span class="n">get_study_files</span><span class="p">(</span><span class="n">required_files</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">downloader</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This notebook was run on 2023-02-27 17:48:13 UTC +0000
Download skipped: No missing files!
</pre></div>
</div>
</div>
</div>
<p>We will also need file <code class="docutils literal notranslate"><span class="pre">MRI_info.csv</span></code> produced by another LivingPark notebook available at <a class="github reference external" href="https://github.com/LivingPark-MRI/livingpark-utils/blob/main/livingpark_utils/notebooks/mri_metadata.ipynb">LivingPark-MRI/livingpark-utils</a>. This file contains a list of T1-weighted MRIs usable for VBM.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">livingpark_utils.scripts</span><span class="w"> </span><span class="kn">import</span> <span class="n">run</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">livingpark_utils.scripts</span><span class="w"> </span><span class="kn">import</span> <span class="n">mri_metadata</span>

<span class="n">run</span><span class="o">.</span><span class="n">mri_metadata</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This notebook was run on 2023-02-27 17:48:18 UTC +0000
[&#39;COR&#39;, &#39;Coronal&#39;, &#39;Cal Head 24&#39;, &#39;Transverse&#39;, &#39;tra_T1_MPRAGE&#39;, &#39;TRA&#39;]
[&#39;AX&#39;, &#39;Ax&#39;, &#39;axial&#39;, &#39;Phantom&#39;, &#39;T2&#39;]
{&#39;Screening&#39;: &#39;SC&#39;, &#39;Baseline&#39;: &#39;BL&#39;, &#39;Month 6&#39;: &#39;V02&#39;, &#39;Month 12&#39;: &#39;V04&#39;, &#39;Month 24&#39;: &#39;V06&#39;, &#39;Month 36&#39;: &#39;V08&#39;, &#39;Month 48&#39;: &#39;V10&#39;, &#39;Symptomatic Therapy&#39;: &#39;ST&#39;, &#39;Unscheduled Visit 01&#39;: &#39;U01&#39;, &#39;Unscheduled Visit 02&#39;: &#39;U02&#39;, &#39;Premature Withdrawal&#39;: &#39;PW&#39;}
Saved in MRI_info.csv
</pre></div>
</div>
</div>
</div>
</section>
<section id="inclusion-criteria">
<h3>Inclusion criteria<a class="headerlink" href="#inclusion-criteria" title="Link to this heading">#</a></h3>
<p>To replicate the cohort in the original study, we used the following inclusion and exclusion criteria among PPMI subjects.</p>
<ol class="arabic">
<li><p>Early stage of the illness (Hoehn and Yahr I and II stage).</p></li>
<li><p>T1-weighted MRI available and usable for VBM (see <a class="reference external" href="https://github.com/LivingPark-MRI/livingpark-utils/blob/main/livingpark_utils/notebooks/mri_metadata.ipynb">MRI metadata notebook</a>).</p></li>
<li><p>Testing at two timepoints.</p></li>
<li><p>MRI and MoCA data available.</p></li>
<li><p>During this evaluation, all patients were OFF medication (at both time points), and did not receive any drugs related to Parkinson’s disease for at least 12h before the sessions.</p></li>
<li><p>MCI inclusion criteria:</p>
<ul class="simple">
<li><p>(i) objective: performance &gt; 1.5 SD below standardized mean on two or more subtests within a cognitive domain.</p></li>
<li><p>(ii)	subjective complaint of cognitive decline.</p></li>
<li><p>(iii)	absence of significant decline in daily living activities.</p></li>
<li><p>(iv)	absence of dementia as diagnosed by the evaluating neuropsychologist.</p></li>
<li><p>(v)	evidence of cognitive abnormalities that cannot be attributed to age.</p></li>
</ul>
<p>Our sample: met PPMI criteria for MCI</p>
</li>
<li><p>Control group:  met PPMI criteria for healthy controls</p></li>
</ol>
<p>Healthy controls also underwent a neuropsychological assessment and those with MCI were excluded.</p>
</section>
<section id="exclusion-criteria">
<h3>Exclusion criteria<a class="headerlink" href="#exclusion-criteria" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Patients excluded if they have other comorbidities.</p></li>
<li><p>Cognitively stable patients who converted to MCI at the neuropsychological assessment at Time 2 were excluded.</p></li>
</ol>
</section>
<section id="group-matching">
<h3>Group matching<a class="headerlink" href="#group-matching" title="Link to this heading">#</a></h3>
<p>•	No significant differences were observed between the three groups with respect to sex, age and education. <br>
•	No significant differences existed between the two patients groups with respect to time since diagnosis or disease advancement as measured by the motor part of the Unified Parkinson’s Disease Rating Scale at Time 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Read data files</span>


<span class="c1"># Demographics</span>
<span class="n">dem</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;Demographics.csv&quot;</span><span class="p">))[</span>
    <span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;SEX&quot;</span><span class="p">,</span> <span class="s2">&quot;BIRTHDT&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="c1"># Age at visit</span>
<span class="n">age</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;Age_at_visit.csv&quot;</span><span class="p">))[</span>
    <span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="c1"># Education</span>
<span class="n">edu</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;Socio-Economics.csv&quot;</span><span class="p">))[</span>
    <span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EDUCYRS&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="c1"># Diagnosis</span>
<span class="n">diag</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;Primary_Clinical_Diagnosis.csv&quot;</span><span class="p">)</span>
<span class="p">)[[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;PRIMDIAG&quot;</span><span class="p">,</span> <span class="s2">&quot;OTHNEURO&quot;</span><span class="p">]]</span>


<span class="c1"># Dx status</span>
<span class="n">dx_status</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;Participant_Status.csv&quot;</span><span class="p">))[</span>
    <span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;COHORT&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="c1"># Disease duration / year of diagnosis</span>
<span class="c1"># med_cond = pd.read_csv(os.path.join(utils.study_files_dir, &quot;Medical_Conditions_Log.csv&quot;))[</span>
<span class="c1">#    [&quot;PATNO&quot;, &quot;EVENT_ID&quot;, &quot;MHDIAGYR&quot;, &quot;MHCAT&quot;]</span>
<span class="c1"># ]</span>


<span class="c1"># PD dx history / disease duration calc</span>
<span class="n">pd_hist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;PD_Diagnosis_History.csv&quot;</span><span class="p">))[</span>
    <span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;PDDXDT&quot;</span><span class="p">]</span>
<span class="p">]</span>


<span class="c1"># Cognitive Categorization</span>
<span class="n">cog_cat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;Cognitive_Categorization.csv&quot;</span><span class="p">)</span>
<span class="p">)[[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;COGSTATE&quot;</span><span class="p">]]</span>


<span class="c1"># Medication</span>
<span class="n">meds</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;Concomitant_Medication_Log.csv&quot;</span><span class="p">))[</span>
        <span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;SEQNO&quot;</span><span class="p">,</span> <span class="s2">&quot;CMTRT&quot;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">])[[</span><span class="s2">&quot;CMTRT&quot;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="p">)</span>  <span class="c1"># aggregate all meds in a tuple</span>

<span class="c1"># L-Dopa</span>
<span class="n">ldopa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;LEDD_Concomitant_Medication_Log.csv&quot;</span><span class="p">)</span>
<span class="p">)[[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;LEDD&quot;</span><span class="p">]]</span>

<span class="c1"># meds = pd.read_csv(os.path.join(utils.study_files_dir, &quot;Concomitant_Medication_Log.csv&quot;))[</span>
<span class="c1">#    [&quot;PATNO&quot;, &quot;EVENT_ID&quot;, &quot;SEQNO&quot;, &quot;CMTRT&quot;]</span>
<span class="c1"># ]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># UPDRS and Hoehh Yahr</span>
<span class="sd">updrs = pd.read_csv(os.path.join(utils.study_files_dir, &quot;MDS_UPDRS_Part_III.csv&quot;))[</span>
<span class="sd">    [&quot;PATNO&quot;, &quot;EVENT_ID&quot;, &quot;PDSTATE&quot;, &quot;NP3TOT&quot;, &quot;NHY&quot;]</span>
<span class="sd">]</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Clean UPDRS file. Impute missing ON/OFF values.</span>
<span class="c1"># It produces MDS_UPDRS_Part_III_clean.csv file</span>
<span class="c1"># from livingpark_utils.scripts import pd_status</span>

<span class="n">updrs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;MDS_UPDRS_Part_III_clean.csv&quot;</span><span class="p">)</span>
<span class="p">)[[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;PDSTATE&quot;</span><span class="p">,</span> <span class="s2">&quot;NP3TOT&quot;</span><span class="p">,</span> <span class="s2">&quot;NHY&quot;</span><span class="p">,</span> <span class="s2">&quot;PDTRTMNT&quot;</span><span class="p">]]</span>

<span class="c1"># MoCA</span>
<span class="n">moca</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;Montreal_Cognitive_Assessment__MoCA_.csv&quot;</span><span class="p">)</span>
<span class="p">)[[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;MCATOT&quot;</span><span class="p">,</span> <span class="s2">&quot;INFODT&quot;</span><span class="p">]]</span>
<span class="c1"># MoCA - Use screening instead of baseline.</span>
<span class="n">moca</span> <span class="o">=</span> <span class="n">moca</span><span class="p">[</span><span class="n">moca</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;BL&quot;</span><span class="p">]</span>
<span class="n">moca</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">moca</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SC&quot;</span><span class="p">,</span> <span class="s2">&quot;BL&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Calculate disease duration</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dateutil.relativedelta</span><span class="w"> </span><span class="kn">import</span> <span class="n">relativedelta</span>

<span class="n">pdxhist</span> <span class="o">=</span> <span class="n">pd_hist</span><span class="p">[(</span><span class="n">pd_hist</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SC&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">pd_hist</span><span class="p">[</span><span class="s2">&quot;PDDXDT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>

<span class="n">pd_dur</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;MDS_UPDRS_Part_III_clean.csv&quot;</span><span class="p">),</span>
    <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)[[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;INFODT&quot;</span><span class="p">]]</span>

<span class="n">PDDXDT_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pdxhist</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">pdxhist</span><span class="p">[</span><span class="s2">&quot;PDDXDT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="n">pd_dur</span><span class="p">[</span><span class="s2">&quot;PDDXDT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd_dur</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">PDDXDT_map</span><span class="p">)</span>

<span class="n">pd_dur</span><span class="p">[</span><span class="s2">&quot;PDXDUR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd_dur</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;INFODT&quot;</span><span class="p">]),</span> <span class="n">parse</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;PDDXDT&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">months</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;PDDXDT&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">pd_dur</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;INFODT&quot;</span><span class="p">,</span> <span class="s2">&quot;PDDXDT&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MRI availability</span>

<span class="n">mri</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">study_files_dir</span><span class="p">,</span> <span class="s2">&quot;MRI_info.csv&quot;</span><span class="p">))</span>
<span class="n">mri</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mri</span><span class="p">[</span><span class="s2">&quot;Visit code&quot;</span><span class="p">]</span>
<span class="n">mri</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mri</span><span class="p">[</span><span class="s2">&quot;Subject ID&quot;</span><span class="p">]</span>
<span class="n">mri</span><span class="p">[</span><span class="s2">&quot;Sex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mri</span><span class="p">[</span><span class="s2">&quot;Sex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">mri</span> <span class="o">=</span> <span class="n">mri</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;Subject ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Visit code&quot;</span><span class="p">,</span> <span class="s2">&quot;Visit&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="s2">&quot;Sex&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mri</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EVENT_ID
BL     1961
V10     442
V04     344
V06     332
ST       10
dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="data-aggregation">
<h2>Data aggregation<a class="headerlink" href="#data-aggregation" title="Link to this heading">#</a></h2>
<p>Merge the data into a single dataframe</p>
<ul class="simple">
<li><p>MRI scan,</p></li>
<li><p>Demographics (sex, age at visit),</p></li>
<li><p>Education (years of education),</p></li>
<li><p>Diagnosis (primary diagnosis),</p></li>
<li><p>Dx status (cohort),</p></li>
<li><p>Medical condition (year of dx, dx category),</p></li>
<li><p>Cognitive category (cognitive state),</p></li>
<li><p>Medication</p></li>
<li><p>UPDRS (ON/OFF state, UPDRS III total score, Hoehn and Yahr stage)</p></li>
<li><p>MoCA (total score)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge into a single df</span>

<span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">mri</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">diag</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dem</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">edu</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dx_status</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pd_hist</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cog_cat</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">meds</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">updrs</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">moca</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pd_dur</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;PATNO&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="pair-visits">
<h1>Pair visits<a class="headerlink" href="#pair-visits" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find visit pairs</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>

<span class="n">visit2month</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;BL&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;V01&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;V02&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;V03&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="s2">&quot;V04&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="s2">&quot;V05&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
    <span class="s2">&quot;V06&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
    <span class="s2">&quot;V07&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s2">&quot;V08&quot;</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span>
    <span class="s2">&quot;V09&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="s2">&quot;V10&quot;</span><span class="p">:</span> <span class="mi">48</span><span class="p">,</span>
    <span class="s2">&quot;V11&quot;</span><span class="p">:</span> <span class="mi">54</span><span class="p">,</span>
    <span class="s2">&quot;V12&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
    <span class="s2">&quot;V13&quot;</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span>
    <span class="s2">&quot;V14&quot;</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span>
    <span class="s2">&quot;V15&quot;</span><span class="p">:</span> <span class="mi">96</span><span class="p">,</span>
    <span class="s2">&quot;V16&quot;</span><span class="p">:</span> <span class="mi">108</span><span class="p">,</span>
    <span class="s2">&quot;V17&quot;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
    <span class="s2">&quot;V18&quot;</span><span class="p">:</span> <span class="mi">132</span><span class="p">,</span>
    <span class="s2">&quot;V19&quot;</span><span class="p">:</span> <span class="mi">144</span><span class="p">,</span>
    <span class="s2">&quot;V20&quot;</span><span class="p">:</span> <span class="mi">156</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">find_visit_pairs</span><span class="p">(</span><span class="n">months</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the pairs of visits closest to each other, given a target time difference in months.&quot;&quot;&quot;</span>

    <span class="n">diff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="n">diff_hist</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="p">(</span><span class="n">k_</span><span class="p">,</span> <span class="n">v_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">visit2month</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">diff_</span> <span class="o">:=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">v_</span><span class="p">)</span> <span class="o">-</span> <span class="n">months</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">diff</span><span class="p">:</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">diff_</span>
            <span class="n">diff_hist</span><span class="p">[</span><span class="n">diff</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">k_</span>

    <span class="k">return</span> <span class="n">diff_hist</span><span class="p">[</span><span class="n">diff</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">sample_cohort</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_df</span><span class="p">[</span><span class="n">_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sample</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="select-healthy-controls">
<h1>Select healthy controls<a class="headerlink" href="#select-healthy-controls" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># diagnosis - use screening instead of baseline when PRIMDIAG is missing at baseline</span>

<span class="n">diag_bl</span> <span class="o">=</span> <span class="n">diag</span><span class="p">[</span><span class="n">diag</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BL&quot;</span><span class="p">]</span>
<span class="n">diag_other</span> <span class="o">=</span> <span class="n">diag</span><span class="p">[</span><span class="n">diag</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;BL&quot;</span><span class="p">]</span>
<span class="n">diag_other</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">diag_other</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SC&quot;</span><span class="p">,</span> <span class="s2">&quot;BL&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">diag_hc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">diag_bl</span><span class="p">,</span> <span class="n">diag_other</span><span class="p">])</span>
<span class="n">diag_hc</span> <span class="o">=</span> <span class="n">diag_hc</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># merge into a single df</span>

<span class="n">df_hc</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">mri</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">diag_hc</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dem</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dx_status</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">edu</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cog_cat</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">moca</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pd_hist</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">meds</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">updrs</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">moca</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pd_dur</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;PATNO&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># find how many visit pairs are available for HC group</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">combinations</span>

<span class="n">events</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;BL&quot;</span><span class="p">,</span> <span class="s2">&quot;V04&quot;</span><span class="p">,</span> <span class="s2">&quot;V06&quot;</span><span class="p">,</span> <span class="s2">&quot;V08&quot;</span><span class="p">,</span> <span class="s2">&quot;V10&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unique HC subjects per visit pairs:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">df_hc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df_hc</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_hc</span><span class="p">[</span><span class="s2">&quot;PRIMDIAG&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">17</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_hc</span><span class="p">[</span><span class="s2">&quot;COHORT&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">][</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">df_hc</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df_hc</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_hc</span><span class="p">[</span><span class="s2">&quot;PRIMDIAG&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">17</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_hc</span><span class="p">[</span><span class="s2">&quot;COHORT&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">][</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v0</span> <span class="o">&amp;</span> <span class="n">v1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">3</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">3</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v0</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">v1</span><span class="p">)</span><span class="si">:</span><span class="s2">&gt;3</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; | Month difference: </span><span class="si">{</span><span class="n">visit2month</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">visit2month</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
<span class="c1">#       print(v0 &amp; v1)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unique HC subjects per visit pairs:
BL  &amp; V04 =  62 | Month difference: 12
BL  &amp; V06 =   9 | Month difference: 24
BL  &amp; V08 =   2 | Month difference: 36
BL  &amp; V10 =  11 | Month difference: 48
V04 &amp; V06 =   8 | Month difference: 12
V04 &amp; V08 =   1 | Month difference: 24
V04 &amp; V10 =  10 | Month difference: 36
V06 &amp; V08 =   2 | Month difference: 12
V06 &amp; V10 =   2 | Month difference: 24
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">pairs_hc</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>

    <span class="n">visit_pairs</span> <span class="o">=</span> <span class="n">find_visit_pairs</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">visit_df</span> <span class="o">=</span> <span class="n">df_hc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;NEXT_VISIT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">visit_pairs</span><span class="p">)</span>

    <span class="n">visit_df</span> <span class="o">=</span> <span class="n">visit_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">visit_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">,</span> <span class="s2">&quot;SEX&quot;</span><span class="p">,</span> <span class="s2">&quot;NEXT_VISIT&quot;</span><span class="p">,</span> <span class="s2">&quot;EDUCYRS&quot;</span><span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">left_on</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;PATNO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NEXT_VISIT&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">right_on</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;PATNO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;_NX&quot;</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">visit_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;PRIMDIAG&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">17</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;COHORT&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;PRIMDIAG_NX&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">17</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;COHORT_NX&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># build database of all available HC</span>
<span class="n">hc_12</span> <span class="o">=</span> <span class="n">pairs_hc</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">hc_24</span> <span class="o">=</span> <span class="n">pairs_hc</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">hc_12</span><span class="p">,</span> <span class="n">hc_24</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">hc</span> <span class="o">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unique HC number before selection: &quot;</span><span class="p">,</span> <span class="n">hc</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<span class="c1"># select 18 HC patients</span>

<span class="n">hc</span> <span class="o">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">hc</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;HC&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hc</span><span class="p">),</span> <span class="s2">&quot;HC subjects were randomly selected&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unique HC number before selection:  67
18 HC subjects were randomly selected
</pre></div>
</div>
</div>
</div>
<section id="data-aggregation-for-pd">
<h2>Data aggregation for PD<a class="headerlink" href="#data-aggregation-for-pd" title="Link to this heading">#</a></h2>
<p>Merge the data into a single dataframe</p>
<ul class="simple">
<li><p>MRI scan,</p></li>
<li><p>Demographics (sex, age at visit),</p></li>
<li><p>Education (years of education),</p></li>
<li><p>Diagnosis (primary diagnosis),</p></li>
<li><p>Dx status (cohort),</p></li>
<li><p>Medical condition (year of dx, dx category),</p></li>
<li><p>Cognitive category (cognitive state),</p></li>
<li><p>Medication</p></li>
<li><p>UPDRS (ON/OFF state, UPDRS III total score, Hoehn and Yahr stage)</p></li>
<li><p>MoCA (total score)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge into a single df for PD</span>

<span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">mri</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">diag</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dem</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">edu</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dx_status</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pd_hist</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cog_cat</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">meds</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">updrs</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">moca</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pd_dur</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;PATNO&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="number-of-available-visit-pairs-pd-meeting-all-the-criteria">
<h2>Number of available visit pairs - PD meeting all the criteria<a class="headerlink" href="#number-of-available-visit-pairs-pd-meeting-all-the-criteria" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pair PD-non-MCI</span>
<span class="c1"># Include Primdiag 1 &amp; Cogstate 1 &amp; Cohort 1 &amp; [NHY 1 | 2] &amp; MoCA &amp; no comorb &amp; UPDRS OFF</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">combinations</span>

<span class="n">events</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;BL&quot;</span><span class="p">,</span> <span class="s2">&quot;V04&quot;</span><span class="p">,</span> <span class="s2">&quot;V06&quot;</span><span class="p">,</span> <span class="s2">&quot;V08&quot;</span><span class="p">,</span> <span class="s2">&quot;V10&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unique PD-non-MCI subjects per visit pairs:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;PRIMDIAG&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;COGSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;COHORT&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;NHY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;MCATOT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OTHNEURO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;PDSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OFF&quot;</span><span class="p">)</span>
        <span class="p">][</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;PRIMDIAG&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;COGSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;COHORT&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;NHY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;MCATOT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OTHNEURO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;PDSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OFF&quot;</span><span class="p">)</span>
        <span class="p">][</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v0</span> <span class="o">&amp;</span> <span class="n">v1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">3</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">3</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v0</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">v1</span><span class="p">)</span><span class="si">:</span><span class="s2">&gt;3</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; | Month difference: </span><span class="si">{</span><span class="n">visit2month</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">visit2month</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unique PD-non-MCI subjects per visit pairs:
BL  &amp; V04 =  27 | Month difference: 12
V04 &amp; V06 =  22 | Month difference: 12
V04 &amp; V10 =  24 | Month difference: 36
V06 &amp; V10 =  32 | Month difference: 24
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pair PD-MCI</span>
<span class="c1"># Include Primdiag 1 &amp; Cogstate 1 &amp; Cohort 1 &amp; [NHY 1 | 2] &amp; MoCA &amp; no comorb &amp; UPDRS OFF</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">combinations</span>

<span class="n">events</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;BL&quot;</span><span class="p">,</span> <span class="s2">&quot;V04&quot;</span><span class="p">,</span> <span class="s2">&quot;V06&quot;</span><span class="p">,</span> <span class="s2">&quot;V08&quot;</span><span class="p">,</span> <span class="s2">&quot;V10&quot;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unique PD-MCI subjects per visit pairs:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;PRIMDIAG&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;COGSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;COHORT&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;NHY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;MCATOT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OTHNEURO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;PDSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OFF&quot;</span><span class="p">)</span>
        <span class="p">][</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;PRIMDIAG&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;COGSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;COHORT&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;NHY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;MCATOT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OTHNEURO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;PDSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OFF&quot;</span><span class="p">)</span>
        <span class="p">][</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v0</span> <span class="o">&amp;</span> <span class="n">v1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">3</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">3</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v0</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">v1</span><span class="p">)</span><span class="si">:</span><span class="s2">&gt;3</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; | Month difference: </span><span class="si">{</span><span class="n">visit2month</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">visit2month</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="c1"># print(v0 &amp; v1)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unique PD-MCI subjects per visit pairs:
BL  &amp; V04 =   2 | Month difference: 12
V04 &amp; V06 =   1 | Month difference: 12
V04 &amp; V10 =   2 | Month difference: 36
V06 &amp; V10 =   5 | Month difference: 24
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="select-pd-mci-patients">
<h1>Select PD-MCI patients<a class="headerlink" href="#select-pd-mci-patients" title="Link to this heading">#</a></h1>
<p>This script has been written with a prior knowledge that there are less PD-MCI patients who meet the inclusion criteria than PD-non-MCI patients in PPMI.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">pairs_mci</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>

    <span class="n">visit_pairs</span> <span class="o">=</span> <span class="n">find_visit_pairs</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">visit_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;NEXT_VISIT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">visit_pairs</span><span class="p">)</span>

    <span class="n">visit_df</span> <span class="o">=</span> <span class="n">visit_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">visit_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">,</span> <span class="s2">&quot;SEX&quot;</span><span class="p">,</span> <span class="s2">&quot;NEXT_VISIT&quot;</span><span class="p">,</span> <span class="s2">&quot;EDUCYRS&quot;</span><span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">left_on</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;PATNO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NEXT_VISIT&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">right_on</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;PATNO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;_NX&quot;</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">visit_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;COGSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;PRIMDIAG&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;COHORT&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;NHY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;MCATOT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;OTHNEURO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;PDSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OFF&quot;</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;COGSTATE_NX&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;PRIMDIAG_NX&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;COHORT_NX&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;NHY_NX&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;MCATOT_NX&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;OTHNEURO_NX&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;PDSTATE_NX&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OFF&quot;</span><span class="p">)</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mci</span> <span class="o">=</span> <span class="n">pairs_mci</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">mci</span> <span class="o">=</span> <span class="n">mci</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mci</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is enough PD-MCI patients. &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mci</span><span class="p">),</span> <span class="s2">&quot; PD-MCI patients found&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">mci_24</span> <span class="o">=</span> <span class="n">pairs_mci</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
    <span class="n">mci</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">mci</span><span class="p">,</span> <span class="n">mci_24</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mci</span> <span class="o">=</span> <span class="n">mci</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mci</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is enough PD-MCI patients. &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mci</span><span class="p">),</span> <span class="s2">&quot; PD-MCI patients found&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mci_36</span> <span class="o">=</span> <span class="n">pairs_mci</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
        <span class="n">mci</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">mci</span><span class="p">,</span> <span class="n">mci_36</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mci</span> <span class="o">=</span> <span class="n">mci</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The final PD-MCI sample size is &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mci</span><span class="p">),</span> <span class="s2">&quot; patients.&quot;</span><span class="p">)</span>

<span class="n">mci</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PD-MCI&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The final PD-MCI sample size is  10  patients.
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="select-pd-non-mci-patients">
<h1>Select PD-non-MCI patients<a class="headerlink" href="#select-pd-non-mci-patients" title="Link to this heading">#</a></h1>
<p>All available pairs for PD-non-MCI patients are selected in this step. They will be matched to a smaller PD-MCI cohort</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">pairs_nonmci</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>

    <span class="n">visit_pairs</span> <span class="o">=</span> <span class="n">find_visit_pairs</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">visit_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;NEXT_VISIT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;EVENT_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">visit_pairs</span><span class="p">)</span>

    <span class="n">visit_df</span> <span class="o">=</span> <span class="n">visit_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">visit_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">,</span> <span class="s2">&quot;SEX&quot;</span><span class="p">,</span> <span class="s2">&quot;NEXT_VISIT&quot;</span><span class="p">,</span> <span class="s2">&quot;EDUCYRS&quot;</span><span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">left_on</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;PATNO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NEXT_VISIT&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">right_on</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;PATNO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;_NX&quot;</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">visit_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
        <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;COGSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;PRIMDIAG&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;COHORT&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;NHY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;MCATOT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;OTHNEURO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;PDSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OFF&quot;</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;COGSTATE_NX&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;PRIMDIAG_NX&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;COHORT_NX&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;NHY_NX&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">])</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;MCATOT_NX&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">())</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;OTHNEURO_NX&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">visit_df</span><span class="p">[</span><span class="s2">&quot;PDSTATE_NX&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OFF&quot;</span><span class="p">)</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wo_mci_12</span> <span class="o">=</span> <span class="n">pairs_nonmci</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">wo_mci_24</span> <span class="o">=</span> <span class="n">pairs_nonmci</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="n">wo_mci_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">wo_mci_12</span><span class="p">,</span> <span class="n">wo_mci_24</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">wo_mci_all</span> <span class="o">=</span> <span class="n">wo_mci_all</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There are &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wo_mci_all</span><span class="p">),</span> <span class="s2">&quot; PD-non-MCI patients to match PD-MCI group.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are  69  PD-non-MCI patients to match PD-MCI group.
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>Group matching<a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<p>Match PD-non-MCI sample to the smaller PD-MCI cohort</p>
<p>We implemented a nearest-neighbor matching loop based on the Euclidean distance.
We will match PD-MCI and PD-non-MCI groups for age, sex, education, UPDRS, and MoCA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">nn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">matched_vars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find index of nearest neighbor of x in df</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Select subjects</span>
    <span class="n">df_match</span> <span class="o">=</span> <span class="n">df</span>

    <span class="c1"># Compute squared distance between x and all elements in df, using normalized variables</span>
    <span class="n">df_match</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
        <span class="p">(</span><span class="n">df_match</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">matched_vars</span>
    <span class="p">)</span>

    <span class="c1"># Return the element in df with the smallest distance</span>
    <span class="n">df_match</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_match</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
        <span class="mi">1</span>
    <span class="p">)</span>  <span class="c1">## there&#39;s probably a better way to do it but it should work</span>


<span class="k">def</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">group1_df</span><span class="p">,</span> <span class="n">group2_df</span><span class="p">,</span> <span class="n">matched_vars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Randomly pick n elements in group1_df, then find n matching elements in group2_df.</span>
<span class="sd">    Ensure that each group only contains 1 or less element from each patient and that</span>
<span class="sd">    no patient has elements in both groups.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">numpy.random</span><span class="w"> </span><span class="kn">import</span> <span class="n">choice</span><span class="p">,</span> <span class="n">seed</span>

    <span class="c1"># Select n random patients in group1</span>
    <span class="n">group1_patnos</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">group1_df</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]))</span>
    <span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># change this to bootstrap population</span>
    <span class="n">group1_patnos_sample</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span>
        <span class="n">group1_patnos</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>  <span class="c1"># !! have to replace due to a small cohort</span>

    <span class="c1"># Remove the selected patients from group2</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">group1_patnos_sample</span><span class="p">:</span>
        <span class="n">group2_df</span> <span class="o">=</span> <span class="n">group2_df</span><span class="p">[</span><span class="n">group2_df</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">]</span>

    <span class="n">group1_matched</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">group1_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">group2_matched</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">group1_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">group1_patnos_sample</span><span class="p">:</span>  <span class="c1"># for each patient in sampled list</span>
        <span class="c1"># Pick a random element from this patient in group1</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">group1_df</span><span class="p">[</span><span class="n">group1_df</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Find the best match in group2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">nn</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">group2_df</span><span class="p">,</span> <span class="n">matched_vars</span><span class="p">)</span>
        <span class="c1"># Add s and t to matched groups</span>
        <span class="n">group1_matched</span> <span class="o">=</span> <span class="n">group1_matched</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">group2_matched</span> <span class="o">=</span> <span class="n">group2_matched</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="c1"># Remove t&#39;s patient from group 2 so that it doesn&#39;t get selected again</span>
        <span class="n">group2_df</span> <span class="o">=</span> <span class="n">group2_df</span><span class="p">[</span><span class="n">group2_df</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">t</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">return</span> <span class="n">group1_matched</span><span class="p">,</span> <span class="n">group2_matched</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># age is not used for matching. if used, the groups differ in MoCA and T2-T1 time</span>

<span class="n">matched_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SEX&quot;</span><span class="p">,</span> <span class="s2">&quot;MCATOT&quot;</span><span class="p">,</span> <span class="s2">&quot;EDUCYRS&quot;</span><span class="p">,</span> <span class="s2">&quot;NP3TOT&quot;</span><span class="p">,</span> <span class="s2">&quot;PDXDUR&quot;</span><span class="p">]</span>


<span class="c1"># Apply matching to get 15 PD-non-MCI patients</span>
<span class="n">mci_matched</span><span class="p">,</span> <span class="n">wo_mci_matched</span> <span class="o">=</span> <span class="n">match</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">mci</span><span class="p">,</span> <span class="n">wo_mci_all</span><span class="p">,</span> <span class="n">matched_vars</span><span class="p">)</span>
<span class="n">patids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">mci_matched</span><span class="p">,</span> <span class="n">wo_mci_matched</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>
<span class="n">mci_matched</span> <span class="o">=</span> <span class="n">mci_matched</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wo_mci_matched</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;There is enough PD-non-MCI patients. &quot;</span><span class="p">,</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">wo_mci_matched</span><span class="p">),</span>
        <span class="s2">&quot; patients included in the analysis.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;There is not enough PD-non-MCI patients. &quot;</span><span class="p">,</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">wo_mci_matched</span><span class="p">),</span>
        <span class="s2">&quot; patients included in the analysis.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">wo_mci_matched</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PD-non-MCI&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There is enough PD-non-MCI patients.  15  patients included in the analysis.
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="descriptive-statistics">
<h1>Descriptive statistics<a class="headerlink" href="#descriptive-statistics" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get UPDRS for patients during ON state</span>

<span class="n">wo_mci_patno</span> <span class="o">=</span> <span class="n">wo_mci_matched</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span>
<span class="n">wo_mci_patno</span> <span class="o">=</span> <span class="n">wo_mci_patno</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">wo_mci_updrs_on</span> <span class="o">=</span> <span class="n">updrs</span><span class="p">[[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;PDSTATE&quot;</span><span class="p">,</span> <span class="s2">&quot;NP3TOT&quot;</span><span class="p">]]</span>
<span class="n">wo_mci_updrs_on</span> <span class="o">=</span> <span class="n">wo_mci_updrs_on</span><span class="p">[</span>
    <span class="p">(</span><span class="n">wo_mci_updrs_on</span><span class="p">[</span><span class="s2">&quot;PDSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ON&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wo_mci_updrs_on</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">wo_mci_patno</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">mci_patno</span> <span class="o">=</span> <span class="n">mci_matched</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span>
<span class="n">mci_patno</span> <span class="o">=</span> <span class="n">mci_patno</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">mci_updrs_on</span> <span class="o">=</span> <span class="n">updrs</span><span class="p">[[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">,</span> <span class="s2">&quot;PDSTATE&quot;</span><span class="p">,</span> <span class="s2">&quot;NP3TOT&quot;</span><span class="p">]]</span>
<span class="n">mci_updrs_on</span> <span class="o">=</span> <span class="n">mci_updrs_on</span><span class="p">[</span>
    <span class="p">(</span><span class="n">mci_updrs_on</span><span class="p">[</span><span class="s2">&quot;PDSTATE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ON&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mci_updrs_on</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mci_patno</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">wo_mci_updrs</span> <span class="o">=</span> <span class="n">wo_mci_matched</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">wo_mci_updrs_on</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;_on&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">mci_updrs</span> <span class="o">=</span> <span class="n">mci_matched</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">mci_updrs_on</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;_on&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert NHY and PATNO string to int</span>
<span class="n">mci_updrs</span><span class="p">[</span><span class="s2">&quot;NHY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">mci_updrs</span><span class="p">[</span><span class="s2">&quot;NHY&quot;</span><span class="p">])</span>
<span class="n">mci_updrs</span><span class="p">[</span><span class="s2">&quot;NHY_NX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">mci_updrs</span><span class="p">[</span><span class="s2">&quot;NHY_NX&quot;</span><span class="p">])</span>
<span class="n">wo_mci_updrs</span><span class="p">[</span><span class="s2">&quot;NHY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">wo_mci_updrs</span><span class="p">[</span><span class="s2">&quot;NHY&quot;</span><span class="p">])</span>
<span class="n">wo_mci_updrs</span><span class="p">[</span><span class="s2">&quot;NHY_NX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">wo_mci_updrs</span><span class="p">[</span><span class="s2">&quot;NHY_NX&quot;</span><span class="p">])</span>
<span class="n">hc</span><span class="p">[</span><span class="s2">&quot;NHY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;NHY&quot;</span><span class="p">])</span>
<span class="n">hc</span><span class="p">[</span><span class="s2">&quot;NHY_NX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;NHY_NX&quot;</span><span class="p">])</span>

<span class="n">mci_updrs</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">mci_updrs</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>
<span class="n">wo_mci_updrs</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">wo_mci_updrs</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span>

<span class="n">mci_final</span> <span class="o">=</span> <span class="n">mci_updrs</span>
<span class="n">wo_mci_final</span> <span class="o">=</span> <span class="n">wo_mci_updrs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate Duration T2-T1 (months)</span>
<span class="c1"># based on MoCA assessment</span>

<span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;INFODT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;INFODT&quot;</span><span class="p">])</span>
<span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;INFODT_NX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;INFODT_NX&quot;</span><span class="p">])</span>
<span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;INFODT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;INFODT&quot;</span><span class="p">])</span>
<span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;INFODT_NX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;INFODT_NX&quot;</span><span class="p">])</span>
<span class="n">hc</span><span class="p">[</span><span class="s2">&quot;INFODT_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;INFODT_x&quot;</span><span class="p">])</span>
<span class="n">hc</span><span class="p">[</span><span class="s2">&quot;INFODT_x_NX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;INFODT_x_NX&quot;</span><span class="p">])</span>

<span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;durationT2_T1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;INFODT_NX&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;INFODT&quot;</span><span class="p">]</span>
<span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
<span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;durationT2_T1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;INFODT_NX&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;INFODT&quot;</span><span class="p">]</span>
<span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
<span class="n">hc</span><span class="p">[</span><span class="s2">&quot;durationT2_T1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;INFODT_x_NX&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">hc</span><span class="p">[</span><span class="s2">&quot;INFODT_x&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">rich</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.console</span><span class="w"> </span><span class="kn">import</span> <span class="n">Console</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rich.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>


<span class="k">def</span><span class="w"> </span><span class="nf">cohort_summary</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">hc</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">mci</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">agg</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s2">&quot;4.1f&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; ± &quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agg</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">agg</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sep</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">col</span><span class="p">]</span><span class="si">:{</span><span class="n">f</span><span class="si">}}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">agg</span><span class="p">])</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">D</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">agg</span><span class="p">][</span><span class="n">col</span><span class="p">]</span><span class="si">:{</span><span class="n">f</span><span class="si">}}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">D</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">gender_ratio</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="n">male_count</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;SEX&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">male_count</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">male_count</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;PATNO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span>

    <span class="n">D</span> <span class="o">=</span> <span class="p">[</span><span class="n">hc</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span> <span class="n">nc</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span> <span class="n">mci</span><span class="o">.</span><span class="n">describe</span><span class="p">()]</span>

    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">box</span><span class="o">=</span><span class="n">rich</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">SIMPLE_HEAVY</span><span class="p">,</span> <span class="n">show_footer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Subject groups&quot;</span><span class="p">,</span> <span class="n">footer</span><span class="o">=</span><span class="s2">&quot;Values expressed as mean ± SD.&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;HC&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PD-non-MCI&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PD-MCI&quot;</span><span class="p">)</span>
    <span class="c1"># table.add_column(&quot;[italic]p&quot;)  # TODO</span>

    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s2">&quot;.0f&quot;</span><span class="p">))</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Age (y)&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">))</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;Age range&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; - &quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;Gender (male, %)&quot;</span><span class="p">,</span> <span class="n">gender_ratio</span><span class="p">(</span><span class="n">hc</span><span class="p">),</span> <span class="n">gender_ratio</span><span class="p">(</span><span class="n">nc</span><span class="p">),</span> <span class="n">gender_ratio</span><span class="p">(</span><span class="n">mci</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;Education (y)&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;EDUCYRS&quot;</span><span class="p">))</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;Disease duration (y)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">agg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;PDXDUR&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># table.add_row(&quot;LEDD (mg/d) baseline&quot;, )  # TODO</span>

    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;H&amp;Y baseline&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;NHY&quot;</span><span class="p">))</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;H&amp;Y follow-up&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;NHY_NX&quot;</span><span class="p">))</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;UPDRS III OFF baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">agg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;NP3TOT&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;UPDRS III ON baseline&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">agg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;NP3TOT_on&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;UPDRS III OFF follow-up&quot;</span><span class="p">,</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">agg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;NP3TOT_NX&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;MoCA baseline&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">agg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;MCATOT&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;MoCA follow-up&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">agg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;MCATOT_NX&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;Duration T2 - T1 (m)&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">gen_row</span><span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">],</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;durationT2_T1&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># test for group differences</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ttest_ind</span><span class="p">,</span> <span class="n">chi2_contingency</span>

<span class="p">[</span><span class="n">chi2_sex</span><span class="p">,</span> <span class="n">p_sex</span><span class="p">,</span> <span class="n">dof_sex</span><span class="p">,</span> <span class="n">expected_sex</span><span class="p">]</span> <span class="o">=</span> <span class="n">chi2_contingency</span><span class="p">(</span>
    <span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">],</span> <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="p">[</span><span class="n">t_age</span><span class="p">,</span> <span class="n">p_age</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">],</span> <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">])</span>
<span class="p">[</span><span class="n">t_edu</span><span class="p">,</span> <span class="n">p_edu</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;EDUCYRS&quot;</span><span class="p">],</span> <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;EDUCYRS&quot;</span><span class="p">])</span>
<span class="p">[</span><span class="n">t_dur</span><span class="p">,</span> <span class="n">p_dur</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;PDXDUR&quot;</span><span class="p">],</span> <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;PDXDUR&quot;</span><span class="p">])</span>
<span class="p">[</span><span class="n">t_updrs_off</span><span class="p">,</span> <span class="n">p_updrs_off</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;NP3TOT&quot;</span><span class="p">],</span> <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;NP3TOT&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;There are&quot;</span><span class="p">,</span>
    <span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;NP3TOT_on&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="s2">&quot;out of&quot;</span><span class="p">,</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">mci_final</span><span class="p">),</span>
    <span class="s2">&quot;missing UPDRS T1 ON values in PD-MCI.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;There are&quot;</span><span class="p">,</span>
    <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;NP3TOT_on&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="s2">&quot;out of&quot;</span><span class="p">,</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">wo_mci_final</span><span class="p">),</span>
    <span class="s2">&quot;missing UPDRS T1 ON values in PD-MCI.&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="p">[</span><span class="n">t_updrs_on</span><span class="p">,</span> <span class="n">p_updrs_on</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;NP3TOT_on&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;NP3TOT_on&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="p">)</span>
<span class="p">[</span><span class="n">t_moca</span><span class="p">,</span> <span class="n">p_moca</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;MCATOT&quot;</span><span class="p">],</span> <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;MCATOT&quot;</span><span class="p">])</span>
<span class="p">[</span><span class="n">t_tdiff</span><span class="p">,</span> <span class="n">p_tdiff</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;durationT2_T1&quot;</span><span class="p">],</span> <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;durationT2_T1&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PD-MCI vs PD-non-MCI p values:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sex p&quot;</span><span class="p">,</span>
    <span class="n">p_sex</span><span class="p">,</span>
    <span class="s2">&quot;edu p&quot;</span><span class="p">,</span>
    <span class="n">p_edu</span><span class="p">,</span>
    <span class="s2">&quot;dx dur p&quot;</span><span class="p">,</span>
    <span class="n">p_dur</span><span class="p">,</span>
    <span class="s2">&quot;updrs off t1 p&quot;</span><span class="p">,</span>
    <span class="n">p_updrs_off</span><span class="p">,</span>
    <span class="s2">&quot;updsr on t1 p&quot;</span><span class="p">,</span>
    <span class="n">p_updrs_on</span><span class="p">,</span>
    <span class="s2">&quot;moca p&quot;</span><span class="p">,</span>
    <span class="n">p_moca</span><span class="p">,</span>
    <span class="s2">&quot;T2-T1 p&quot;</span><span class="p">,</span>
    <span class="n">p_tdiff</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">chi2_sex</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no difference between PD-MCI and PD-non-MCI in sex frequency&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is a difference between PD-MCI and PD-non-MCI in sex frequency&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">p_edu</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no difference between PD-MCI and PD-non-MCI in years of education&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is a difference between PD-MCI and PD-non-MCI in years of education&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">p_dur</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no difference between PD-MCI and PD-non-MCI in disease duration&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is a difference between PD-MCI and PD-non-MCI in disease duration&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">p_updrs_off</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no difference between PD-MCI and PD-non-MCI in UPDRS T1 OFF&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is a difference between PD-MCI and PD-non-MCI in UPDRS T1 OFF&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">p_updrs_on</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no difference between PD-MCI and PD-non-MCI in UPDRS T1 ON&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is a difference between PD-MCI and PD-non-MCI in UPDRS T1 ON&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">p_moca</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no difference between PD-MCI and PD-non-MCI in MoCA&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is a difference between PD-MCI and PD-non-MCI in MoCA&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">p_tdiff</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;There is no difference between PD-MCI and PD-non-MCI in the time between T1 and T2&quot;</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;There is a difference between PD-MCI and PD-non-MCI in the time between T1 and T2&quot;</span>
    <span class="p">)</span>


<span class="p">[</span><span class="n">t_tdiff_mci_hc</span><span class="p">,</span> <span class="n">p_tdiff_mci_hc</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;durationT2_T1&quot;</span><span class="p">],</span> <span class="n">hc</span><span class="p">[</span><span class="s2">&quot;durationT2_T1&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="p">[</span><span class="n">t_tdiff_womci_hc</span><span class="p">,</span> <span class="n">p_tdiff_womci_hc</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;durationT2_T1&quot;</span><span class="p">],</span> <span class="n">hc</span><span class="p">[</span><span class="s2">&quot;durationT2_T1&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="p">[</span><span class="n">t_age_mci_hc</span><span class="p">,</span> <span class="n">p_age_mci_hc</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">mci_final</span><span class="p">[</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">],</span> <span class="n">hc</span><span class="p">[</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">])</span>
<span class="p">[</span><span class="n">t_age_womci_hc</span><span class="p">,</span> <span class="n">p_age_womci_hc</span><span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">wo_mci_final</span><span class="p">[</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">],</span> <span class="n">hc</span><span class="p">[</span><span class="s2">&quot;AGE_AT_VISIT&quot;</span><span class="p">]</span>
<span class="p">)</span>


<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HC vs PD p values:&quot;</span><span class="p">,</span>
    <span class="s2">&quot;T2-T1 mci-hc&quot;</span><span class="p">,</span>
    <span class="n">p_tdiff_mci_hc</span><span class="p">,</span>
    <span class="s2">&quot;T2-T1 nonmci-hc&quot;</span><span class="p">,</span>
    <span class="n">p_tdiff_womci_hc</span><span class="p">,</span>
    <span class="s2">&quot;age mci-hc&quot;</span><span class="p">,</span>
    <span class="n">p_age_mci_hc</span><span class="p">,</span>
    <span class="s2">&quot;age nonmci-hc&quot;</span><span class="p">,</span>
    <span class="n">p_age_womci_hc</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">p_tdiff_mci_hc</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no difference between HC and PD-MCI in the time between T1 and T2&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is a difference between HC and PD-MCI in the time between T1 and T2&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">p_tdiff_womci_hc</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;There is no difference between HC and PD-non-MCI in the time between T1 and T2&quot;</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;There is a difference between HC and PD-non-MCI in the time between T1 and T2&quot;</span>
    <span class="p">)</span>
<span class="k">if</span> <span class="n">p_age_mci_hc</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no difference between HC and PD-MCI in age&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is a difference between HC and PD-MCI in age&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">p_age_womci_hc</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no difference between HC and PD-non-MCI in age&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is a difference between HC and PD-non-MCI in age&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 5 out of 10 missing UPDRS T1 ON values in PD-MCI.
There are 8 out of 15 missing UPDRS T1 ON values in PD-MCI.

 PD-MCI vs PD-non-MCI p values: sex p 1.0 edu p nan dx dur p 0.8983646622916739 updrs off t1 p 0.5450424659830888 updsr on t1 p 0.7236375666275758 moca p 0.05359221099902946 T2-T1 p 0.1105534586592145 

There is a difference between PD-MCI and PD-non-MCI in sex frequency
There is a difference between PD-MCI and PD-non-MCI in years of education
There is no difference between PD-MCI and PD-non-MCI in disease duration
There is no difference between PD-MCI and PD-non-MCI in UPDRS T1 OFF
There is no difference between PD-MCI and PD-non-MCI in UPDRS T1 ON
There is no difference between PD-MCI and PD-non-MCI in MoCA
There is no difference between PD-MCI and PD-non-MCI in the time between T1 and T2

 HC vs PD p values: T2-T1 mci-hc 0.0003446193620317317 T2-T1 nonmci-hc 0.003927490083541382 age mci-hc 0.7625053437811584 age nonmci-hc 0.19923697998278472 

There is a difference between HC and PD-MCI in the time between T1 and T2
There is a difference between HC and PD-non-MCI in the time between T1 and T2
There is no difference between HC and PD-MCI in age
There is no difference between HC and PD-non-MCI in age
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cohort_summary</span><span class="p">(</span>
    <span class="n">hc</span><span class="o">=</span><span class="n">hc</span><span class="p">,</span>
    <span class="n">nc</span><span class="o">=</span><span class="n">wo_mci_final</span><span class="p">,</span>
    <span class="n">mci</span><span class="o">=</span><span class="n">mci_final</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Demographic and clinical characteristics&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-style: italic">                  Demographic and clinical characteristics                  </span>
                                                                            
 <span style="font-weight: bold"> Subject groups                 </span> <span style="font-weight: bold"> HC          </span> <span style="font-weight: bold"> PD-non-MCI  </span> <span style="font-weight: bold"> PD-MCI      </span> 
 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 
  n                                18            15            10           
  Age (y)                          66.9 ±  6.1   63.4 ±  9.4   67.6 ±  5.8  
  Age range                        53.2 - 76.8   42.8 - 75.3   61.0 - 79.2  
  Gender (male, %)                 15, 83.3%     10, 66.7%     10, 100.0%   
  Education (y)                    16.1 ±  2.9   14.5 ±  1.9   14.6 ±  2.4  
  Disease duration (y)                            5.1 ±  3.1    4.9 ±  3.3  
  H&amp;Y baseline                      0.0 ±  0.0    1.7 ±  0.5    1.8 ±  0.4  
  H&amp;Y follow-up                     0.1 ±  0.5    1.7 ±  0.5    1.8 ±  0.4  
  UPDRS III OFF baseline                         22.3 ± 10.8   25.2 ± 13.0  
  UPDRS III ON baseline                          17.7 ±  9.6   20.2 ± 14.3  
  UPDRS III OFF follow-up                        25.7 ± 11.3   29.3 ± 13.6  
  MoCA baseline                                  25.9 ±  1.8   24.3 ±  1.9  
  MoCA follow-up                                 27.0 ±  1.7   24.5 ±  2.4  
  Duration T2 - T1 (m)             14.5 ±  2.9   19.1 ±  5.4   23.9 ±  9.0  
 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 
 <span style="font-weight: bold"> Values expressed as mean ± SD. </span> <span style="font-weight: bold">             </span> <span style="font-weight: bold">             </span> <span style="font-weight: bold">             </span> 
                                                                            
</pre>
</div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="get-mri-data">
<h1>Get MRI data<a class="headerlink" href="#get-mri-data" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">mci_final</span><span class="p">,</span> <span class="n">wo_mci_final</span><span class="p">,</span> <span class="n">hc</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">merged_data</span><span class="p">[</span><span class="s2">&quot;visit_no&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;first&quot;</span>

<span class="n">second_visit</span> <span class="o">=</span> <span class="n">merged_data</span>
<span class="n">second_visit</span> <span class="o">=</span> <span class="n">second_visit</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">second_visit</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Description_NX&quot;</span><span class="p">:</span> <span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_ID_NX&quot;</span><span class="p">:</span> <span class="s2">&quot;EVENT_ID&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">second_visit</span><span class="p">[</span><span class="s2">&quot;visit_no&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;second&quot;</span>
<span class="n">download_data</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">second_visit</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># download MRI data</span>

<span class="n">utils</span><span class="o">.</span><span class="n">get_T1_nifti_files</span><span class="p">(</span><span class="n">download_data</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">downloader</span><span class="p">,</span> <span class="n">symlink</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Download skipped: No missing files!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rename PATNO to distinguish between the first and the second visit after preprocessing</span>
<span class="c1"># PATNO is used as dir name during preprocessing</span>

<span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;PATNO_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;visit_no&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="image-preprocessing">
<h1>Image preprocessing<a class="headerlink" href="#image-preprocessing" title="Link to this heading">#</a></h1>
<p>Data is preprocessed using Freesurfer’s recon-all.</p>
<p><strong>Segmentation</strong></p>
<p>We only segment images for which an existing segmentation is not found in directory outputs.</p>
<section id="preprocessing-pipeline-by-hanganu-et-al">
<h2>Preprocessing pipeline by Hanganu et al.<a class="headerlink" href="#preprocessing-pipeline-by-hanganu-et-al" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Cortical reconstruction and volumetric segmentation was performed with FreeSurfer 5.3</p></li>
<li><p>motion correction and averaging of multiple volumetric T1-weighted images, removal of non-brain tissue using a hybrid surface deformation procedure, automated Talairach transformation, segmentation of the subcortical white matter and deep grey matter volumetric structures, intensity normalization, tessellation of the grey/white matter boundary, automated topology correction, and surface deformation following intensity gradients to optimally place the grey/ white and grey/cerebrospinal fluid borders at the location where the greatest shift in intensity defines the transition to the other tissue class.</p></li>
<li><p>images where automatically processed with the longitudinal stream. Specifically an unbiased within-subject template space and image was created using robust, inverse consistent registration.</p></li>
<li><p>Several processing steps, such as skull stripping, Talairach transforms, atlas registration as well as spherical surface maps and parcellations were then initialized with common information from the within-subject template.</p></li>
<li><p>Misclassification of tissue types was corrected by minimal manual adjustment. Cortical thickness was calculated as the closest distance from the grey/white matter boundary to the grey/cerebrospinal fluid boundary at each vertex on the tessellated surface.</p></li>
<li><p>Cortical thickness was smoothed with a 10-mm full-width half-height Gaussian kernel to reduce local variations in the measurements (# whole-brain correlation with MoCA).</p></li>
<li><p>For the analysis of subcortical longitudinal changes, the subcortical structures were segmented in order to obtain their volumes. The volumes were then corrected by performing a regression over the estimated total intracranial volume.</p></li>
</ul>
<p>Analyses were performed on Compute Canada servers (Advanced Research Computing facilities provided by the Compute Canada Federation). If you don’t have Compute Canada account you may be able to request one <a class="reference external" href="https://ccdb.computecanada.ca/security/login">here</a>.</p>
<p>Otherwise, please use any other available server or your local machine to run the analyses. You may need to adjust the following code depending on the method you use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># copy working directory to Compute Canada server</span>

<span class="c1"># please provide the following:</span>
<span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># please change to the hostname you use</span>
<span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># please provide your Compute Canada username</span>
<span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># please provide your Compute Canada password</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">paramiko</span><span class="w"> </span><span class="kn">import</span> <span class="n">SSHClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scp</span><span class="w"> </span><span class="kn">import</span> <span class="n">SCPClient</span>

<span class="n">ssh</span> <span class="o">=</span> <span class="n">SSHClient</span><span class="p">()</span>
<span class="n">ssh</span><span class="o">.</span><span class="n">load_system_host_keys</span><span class="p">()</span>
<span class="n">ssh</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">hostname</span><span class="o">=</span><span class="n">hostname</span><span class="p">,</span>
    <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># SCPCLient takes a paramiko transport as its only argument</span>
<span class="n">scp</span> <span class="o">=</span> <span class="n">SCPClient</span><span class="p">(</span><span class="n">ssh</span><span class="o">.</span><span class="n">get_transport</span><span class="p">())</span>

<span class="n">cdir</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span>
<span class="n">scp</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">cdir</span><span class="p">,</span> <span class="s2">&quot;hanganu&quot;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># scp.get(&#39;file_path_on_remote_machine&#39;, &#39;file_path_on_local_machine&#39;)</span>

<span class="n">scp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="preprocessing">
<h1>Preprocessing<a class="headerlink" href="#preprocessing" title="Link to this heading">#</a></h1>
<p>Data are preprocessed using longitudinal stream implemented in Freesurfer. <a href=https://surfer.nmr.mgh.harvard.edu/fswiki/LongitudinalProcessing> Click here for details.</a></p>
<p>Preprocessing is performed on an external server. <a href=https://github.com/boutiques> Boutiques</a> is used to manage Freesurfer’s functions within a container.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> slurm_magic
</pre></div>
</div>
</div>
</div>
<section id="preprocessing-step-1-cross-sectional">
<h2>preprocessing step 1 - cross-sectional<a class="headerlink" href="#preprocessing-step-1-cross-sectional" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare node for computation. it includes downloading the container</span>

<span class="o">!</span><span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>singularity

<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>

<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.4043546&quot;</span>
<span class="n">bosh</span><span class="p">([</span><span class="s2">&quot;exec&quot;</span><span class="p">,</span> <span class="s2">&quot;prepare&quot;</span><span class="p">,</span> <span class="n">zid</span><span class="p">])</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">boutiques</span><span class="o">.</span><span class="n">descriptor2func</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exclude subjects from the dataset if the image was already preprocessed</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os.path</span>

<span class="n">data_to_process</span> <span class="o">=</span> <span class="n">download_data</span>

<span class="k">for</span> <span class="n">patno</span> <span class="ow">in</span> <span class="n">data_to_process</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]:</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;preproc_FS_codes/exitcode_</span><span class="si">{0}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">patno</span><span class="p">))</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">exitcode</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;preproc_FS_codes/exitcode_</span><span class="si">{0}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">patno</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exitcode</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data_to_process</span><span class="o">.</span><span class="n">drop</span><span class="p">[</span><span class="s2">&quot;[0]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">patno</span><span class="p">)]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The image ID&quot;</span><span class="p">,</span> <span class="n">patno</span><span class="p">,</span> <span class="s2">&quot;has been preprocessed.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exitcode</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The image ID&quot;</span><span class="p">,</span> <span class="n">patno</span><span class="p">,</span> <span class="s2">&quot;has not been preprocessed successfully.&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The image ID&quot;</span><span class="p">,</span> <span class="n">patno</span><span class="p">,</span> <span class="s2">&quot;has not been preprocessed at all.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># save df with all timepoints as json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;PATNO_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;PATNO_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<span class="n">data_to_process</span> <span class="o">=</span> <span class="n">download_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">small_df</span> <span class="o">=</span> <span class="n">data_to_process</span><span class="p">[[</span><span class="s2">&quot;PATNO_id&quot;</span><span class="p">,</span> <span class="s2">&quot;File name&quot;</span><span class="p">]]</span>
<span class="n">json_data</span> <span class="o">=</span> <span class="n">small_df</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="n">meta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;json_data.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> preprocess_FS.py

<span class="c1"># save proprocessing script to submit jobs to the server later </span>
<span class="c1"># copy your FreeSurfer license to FS_license/license.txt or update the license path below</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>
<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.4043546&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques.descriptor2func</span><span class="w"> </span><span class="kn">import</span> <span class="n">function</span>
<span class="c1">#bosh([&quot;exec&quot;, &quot;prepare&quot;, zid])</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>

<span class="n">task_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SLURM_ARRAY_TASK_ID&quot;</span><span class="p">])</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;json_data.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">subject_map</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span>

    
<span class="n">out_fs</span> <span class="o">=</span> <span class="n">freesurfer</span><span class="p">(</span><span class="s1">&#39;--imagepath&#39;</span><span class="p">,</span> <span class="s1">&#39;freesurfer-freesurfer-7.1.1.simg.tmp&#39;</span><span class="p">,</span>
                                        <span class="nb">input</span><span class="o">=</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;File name&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">],</span> <span class="n">qcache_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">license</span><span class="o">=</span><span class="s2">&quot;FS_license/license.txt&quot;</span><span class="p">,</span>
                                        <span class="n">subjid</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;PATNO_id&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">]),</span>
                                       <span class="p">)</span>

<span class="c1">#exitcode = out.stdout</span>
<span class="n">exitcode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_fs</span><span class="o">.</span><span class="n">exit_code</span><span class="p">)</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;preproc_FS_codes/exitcode_</span><span class="si">{0}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;PATNO_id&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">])),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exitcode</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sbatch</span> --array=0-85
#!/bin/bash
#SBATCH --job-name=FS_preproc
#SBATCH --mem=4G
#SBATCH --cpus-per-task=2
#SBATCH --nodes=1
#SBATCH --output=FS_preproc.out
#SBATCH --error=FS_preproc.err
#SBATCH --time=10:0:0

. venv/bin/activate # opens virtual environment. change depending where you proprocess the data  

module load singularity

python preprocess_FS.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="preprocessing-step-2-base-template">
<h2>preprocessing step 2 - base template<a class="headerlink" href="#preprocessing-step-2-base-template" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># save df with a single input for each subject as json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<span class="n">data_to_process</span> <span class="o">=</span> <span class="n">download_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">small_df</span> <span class="o">=</span> <span class="n">data_to_process</span><span class="p">[[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]]</span>
<span class="n">small_df</span> <span class="o">=</span> <span class="n">small_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">json_data</span> <span class="o">=</span> <span class="n">small_df</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="n">meta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;json_data_base.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> preprocess_FS_base.py

<span class="c1"># Step 2. create an unbiased template from all time points for each subject and process it with recon-all:</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>
<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7327935&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques.descriptor2func</span><span class="w"> </span><span class="kn">import</span> <span class="n">function</span>
<span class="c1">#bosh([&quot;exec&quot;, &quot;prepare&quot;, zid])</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>

<span class="n">task_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SLURM_ARRAY_TASK_ID&quot;</span><span class="p">])</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;json_data_base.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">subject_map</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span>

<span class="n">out_fs</span> <span class="o">=</span> <span class="n">freesurfer</span><span class="p">(</span><span class="s1">&#39;--imagepath&#39;</span><span class="p">,</span> <span class="s1">&#39;freesurfer-freesurfer-7.1.1.simg.tmp&#39;</span><span class="p">,</span>
                                        <span class="n">tp1</span><span class="o">=</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="o">+</span><span class="s2">&quot;_first&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">],</span>
                                        <span class="n">tp2</span><span class="o">=</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="o">+</span><span class="s2">&quot;_second&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">],</span>
                                        <span class="n">license</span><span class="o">=</span><span class="s2">&quot;FS_license/license.txt&quot;</span><span class="p">,</span>
                                        <span class="n">outputdir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="o">+</span><span class="s2">&quot;_base&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">]),</span>
                                       <span class="p">)</span>


<span class="n">exitcode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_fs</span><span class="o">.</span><span class="n">exit_code</span><span class="p">)</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;preproc_FS_codes/exitcode_base_</span><span class="si">{0}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">])),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exitcode</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sbatch</span> --array=0-42
#!/bin/bash
#SBATCH --job-name=FS_preproc
#SBATCH --mem=4G
#SBATCH --cpus-per-task=2
#SBATCH --nodes=1
#SBATCH --output=FS_preproc_base.out
#SBATCH --error=FS_preproc_base.err
#SBATCH --time=10:0:0

. venv/bin/activate # opens virtual environment. change depending where you proprocess the data  

module load singularity

python preprocess_FS_base.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="preprocessing-step-3-longitudinally-processed-timepoints">
<h2>preprocessing step 3 - longitudinally processed timepoints<a class="headerlink" href="#preprocessing-step-3-longitudinally-processed-timepoints" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare node for computation</span>
<span class="c1"># this should be run on a server connected to the internet</span>
<span class="c1"># load recon-all base descriptor</span>

<span class="o">!</span><span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>singularity

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>

<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7339689&quot;</span>
<span class="c1"># bosh([&quot;exec&quot;, &quot;prepare&quot;, zid])</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">boutiques</span><span class="o">.</span><span class="n">descriptor2func</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># save df with all timepoints and base as json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;PATNO_base&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_base&quot;</span>
<span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;PATNO_base&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">download_data</span><span class="p">[</span><span class="s2">&quot;PATNO_base&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<span class="n">data_to_process</span> <span class="o">=</span> <span class="n">download_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">small_df</span> <span class="o">=</span> <span class="n">data_to_process</span><span class="p">[[</span><span class="s2">&quot;PATNO_id&quot;</span><span class="p">,</span> <span class="s2">&quot;PATNO_base&quot;</span><span class="p">]]</span>
<span class="n">json_data</span> <span class="o">=</span> <span class="n">small_df</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="n">meta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;json_data_long.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> preprocess_FS_long.py

<span class="c1"># Step 3. &quot;-long&quot; longitudinally process all timepoints (recon-all -long):</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>
<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7339689&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques.descriptor2func</span><span class="w"> </span><span class="kn">import</span> <span class="n">function</span>
<span class="c1">#bosh([&quot;exec&quot;, &quot;prepare&quot;, zid])</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>

<span class="n">task_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SLURM_ARRAY_TASK_ID&quot;</span><span class="p">])</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;json_data_long.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">subject_map</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span>

<span class="n">out_fs</span> <span class="o">=</span> <span class="n">freesurfer</span><span class="p">(</span><span class="s1">&#39;--imagepath&#39;</span><span class="p">,</span> <span class="s1">&#39;freesurfer-freesurfer-7.1.1.simg.tmp&#39;</span><span class="p">,</span>
                                        <span class="n">tp</span><span class="o">=</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;PATNO_id&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">],</span>
                                        <span class="n">base</span><span class="o">=</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;PATNO_base&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">],</span>
                                        <span class="n">license</span><span class="o">=</span><span class="s2">&quot;FS_license/license.txt&quot;</span><span class="p">,</span>
                                       <span class="p">)</span>


<span class="n">exitcode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_fs</span><span class="o">.</span><span class="n">exit_code</span><span class="p">)</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;preproc_FS_codes/exitcode_long_</span><span class="si">{0}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;PATNO_id&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">])),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exitcode</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sbatch</span> --array=0-85
#!/bin/bash
#SBATCH --job-name=FS_preproc
#SBATCH --mem=4G
#SBATCH --cpus-per-task=2
#SBATCH --nodes=1
#SBATCH --output=FS_preproc_long.out
#SBATCH --error=FS_preproc_long.err
#SBATCH --time=10:0:0

. venv/bin/activate # opens virtual environment. change depending where you proprocess the data  

module load singularity

python preprocess_FS_long.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="preprocessing-step-4-qcache">
<h2>preprocessing step 4 - Qcache<a class="headerlink" href="#preprocessing-step-4-qcache" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> preprocess_FS_long_qcache.py

<span class="c1"># save proprocessing script to submit jobs to the server later </span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>
<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7343403&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques.descriptor2func</span><span class="w"> </span><span class="kn">import</span> <span class="n">function</span>
<span class="c1">#bosh([&quot;exec&quot;, &quot;prepare&quot;, zid])</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>

<span class="n">task_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;SLURM_ARRAY_TASK_ID&quot;</span><span class="p">])</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;json_data_long.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">subject_map</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span>

    
<span class="n">out_fs</span> <span class="o">=</span> <span class="n">freesurfer</span><span class="p">(</span><span class="s1">&#39;--imagepath&#39;</span><span class="p">,</span> <span class="s1">&#39;freesurfer-freesurfer-7.1.1.simg.tmp&#39;</span><span class="p">,</span>
                                        <span class="n">tp</span><span class="o">=</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;PATNO_id&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">],</span>
                                        <span class="n">base</span><span class="o">=</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;PATNO_base&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">],</span>
                                        <span class="n">license</span><span class="o">=</span><span class="s2">&quot;FS_license/license.txt&quot;</span><span class="p">,</span>
                                       <span class="p">)</span>

<span class="c1">#exitcode = out.stdout</span>
<span class="n">exitcode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_fs</span><span class="o">.</span><span class="n">exit_code</span><span class="p">)</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;preproc_FS_codes/exitcode_longQcache_</span><span class="si">{0}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">subject_map</span><span class="p">[</span><span class="s2">&quot;PATNO_id&quot;</span><span class="p">][</span><span class="n">task_id</span><span class="p">])),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exitcode</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sbatch</span> --array=0-85
#!/bin/bash
#SBATCH --job-name=FS_preproc_longQcache
#SBATCH --mem=4G
#SBATCH --cpus-per-task=2
#SBATCH --nodes=1
#SBATCH --output=FS_preproc_longQcache.out
#SBATCH --error=FS_preproc_longQcache.err
#SBATCH --time=2:0:0

. venv/bin/activate # opens virtual environment. change depending where you proprocess the data  

module load singularity

python preprocess_FS_long_qcache.py
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="image-quality-control">
<h1>Image quality control<a class="headerlink" href="#image-quality-control" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">imageio</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">iio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;axial&quot;</span><span class="p">,</span> <span class="s2">&quot;sagittal&quot;</span><span class="p">,</span> <span class="s2">&quot;coronal&quot;</span><span class="p">]:</span>
    <span class="n">images</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;segm/</span><span class="si">{view}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">))</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">continue</span>

        <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
        <span class="n">iio</span><span class="o">.</span><span class="n">mimsave</span><span class="p">(</span><span class="s2">&quot;segm_</span><span class="si">{view}</span><span class="s2">.gif&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">),</span> <span class="n">images</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="axial">
<h2>Axial<a class="headerlink" href="#axial" title="Link to this heading">#</a></h2>
<p><img alt="SegmentLocal" src="../../_images/segm_axial.gif" /></p>
</section>
<section id="coronal">
<h2>Coronal<a class="headerlink" href="#coronal" title="Link to this heading">#</a></h2>
<p><img alt="SegmentLocal" src="../../_images/segm_coronal.gif" /></p>
</section>
<section id="sagittal">
<h2>Sagittal<a class="headerlink" href="#sagittal" title="Link to this heading">#</a></h2>
<p><img alt="SegmentLocal" src="../../_images/segm_sagittal.gif" /></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="postprocessing">
<h1>Postprocessing<a class="headerlink" href="#postprocessing" title="Link to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="roi-analysis">
<h1>ROI analysis<a class="headerlink" href="#roi-analysis" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate MoCA T1 - T2 difference</span>
<span class="n">merged_data</span><span class="p">[</span><span class="s2">&quot;MCATOT_diff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_data</span><span class="p">[</span><span class="s2">&quot;MCATOT&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged_data</span><span class="p">[</span><span class="s2">&quot;MCATOT_NX&quot;</span><span class="p">]</span>


<span class="c1"># extract cortical thickness and volumes</span>

<span class="n">aseg_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">aseg_table</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_data</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span>


<span class="n">ROIs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Left-Thalamus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Left-Caudate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Left-Putamen&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Left-Pallidum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Left-Hippocampus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Left-Amygdala&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Left-Accumbens-area&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Right-Thalamus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Right-Caudate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Right-Putamen&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Right-Pallidum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Right-Hippocampus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Right-Amygdala&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Right-Accumbens-area&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">for</span> <span class="n">subj</span> <span class="ow">in</span> <span class="n">aseg_table</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;_first&quot;</span><span class="p">,</span> <span class="s2">&quot;_second&quot;</span><span class="p">]:</span>

        <span class="c1"># extract TIV</span>
        <span class="n">file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{subidd}{ses}</span><span class="s2">.long.</span><span class="si">{subidd}</span><span class="s2">_base/stats/aseg.stats&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">subidd</span><span class="o">=</span><span class="n">subj</span><span class="p">,</span> <span class="n">ses</span><span class="o">=</span><span class="n">session</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="c1"># read all lines in a list</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="c1"># check if string present on a current line</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Estimated Total Intracranial Volume&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">aseg_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                        <span class="n">aseg_table</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subj</span><span class="p">,</span> <span class="s2">&quot;TIV</span><span class="si">{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">])</span>

                    <span class="c1"># aseg_table[&quot;TIV{ses}&quot;.format(ses = session)] = float(out)</span>

        <span class="c1"># extract cortical thickness</span>
        <span class="k">for</span> <span class="n">hemi</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{subidd}{ses}</span><span class="s2">.long.</span><span class="si">{subidd}</span><span class="s2">_base/stats/</span><span class="si">{hemisphere}</span><span class="s2">.aparc.a2009s.stats&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">subidd</span><span class="o">=</span><span class="n">subj</span><span class="p">,</span> <span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">,</span> <span class="n">hemisphere</span><span class="o">=</span><span class="n">hemi</span>
            <span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="c1"># read all lines in a list</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Mean Thickness&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">aseg_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="n">aseg_table</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subj</span><span class="p">,</span>
                            <span class="s2">&quot;thickness_</span><span class="si">{hemi}{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">,</span> <span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">),</span>
                        <span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">])</span>

        <span class="n">aseg_table</span><span class="p">[</span><span class="s2">&quot;thickness_bil</span><span class="si">{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">aseg_table</span><span class="p">[</span><span class="s2">&quot;thickness_lh</span><span class="si">{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">)]</span>
            <span class="o">+</span> <span class="n">aseg_table</span><span class="p">[</span><span class="s2">&quot;thickness_rh</span><span class="si">{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">)]</span>
        <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># extract ROIs volume</span>
        <span class="k">for</span> <span class="n">roi</span> <span class="ow">in</span> <span class="n">ROIs</span><span class="p">:</span>

            <span class="n">file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{subidd}{ses}</span><span class="s2">.long.</span><span class="si">{subidd}</span><span class="s2">_base/stats/aseg.stats&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">subidd</span><span class="o">=</span><span class="n">subj</span><span class="p">,</span> <span class="n">ses</span><span class="o">=</span><span class="n">session</span>
            <span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">aseg_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                            <span class="n">aseg_table</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subj</span><span class="p">,</span>
                            <span class="n">roi</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">),</span>
                        <span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span>

        <span class="c1"># calculate bilateral volume</span>

        <span class="n">ROIs_bil</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Thalamus</span><span class="si">{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">),</span>
            <span class="s2">&quot;Caudate</span><span class="si">{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">),</span>
            <span class="s2">&quot;Putamen</span><span class="si">{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">),</span>
            <span class="s2">&quot;Pallidum</span><span class="si">{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">),</span>
            <span class="s2">&quot;Hippocampus</span><span class="si">{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">),</span>
            <span class="s2">&quot;Amygdala</span><span class="si">{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">),</span>
            <span class="s2">&quot;Accumbens-area</span><span class="si">{ses}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ses</span><span class="o">=</span><span class="n">session</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">roi_bil</span> <span class="ow">in</span> <span class="n">ROIs_bil</span><span class="p">:</span>
            <span class="n">aseg_table</span><span class="p">[</span><span class="n">roi_bil</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">aseg_table</span><span class="p">[</span><span class="s2">&quot;Right-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">roi_bil</span><span class="p">)]</span>
                <span class="o">+</span> <span class="n">aseg_table</span><span class="p">[</span><span class="s2">&quot;Left-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">roi_bil</span><span class="p">)]</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ROI_data</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">aseg_table</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;TIV_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;TIV_first&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;TIV_second&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>For the analysis of subcortical longitudinal changes, the subcortical structures were segmented in order to obtain their volumes. <strong>The volumes were then corrected by performing a regression over the estimated total intracranial volume.</strong> Previous studies have shown that estimated total intracranial volume provides a robust method for head size correction that is equivalent to manual intracranial volume correction (Buckner et al., 2004) and the regression-based correctional method may provide advantages over the proportion- based method (Sanfilipo et al., 2004).</p>
<p>After this, the differences between the two time points of corrected subcortical volumes were computed, and <strong>additional corrections were performed using the averages of the two time points for each subject as a regression.</strong> This was done to reduce the variability linked to the differences in the initial volumes for each participant. The percentage of change was computed with respect to the first time point for each subject.</p>
<p>Significant differences between groups were computed using the Student’s t-test analysis and were set to P &lt; 0.05. We also correlated the evolution of subcortical volumes between Time 1 and Time 2 and the evolution of Montreal Cognitive Assessment scores between Times 1 and 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this calculates the change in subcortical volume and cortical thickness change</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="n">reg</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>

<span class="c1"># correct the bilateral ROIs volumes by performing a regression over the estimated total intracranial volume</span>

<span class="n">ROIs_bil</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Thalamus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Caudate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Putamen&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Pallidum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Hippocampus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Amygdala&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Accumbens-area&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">roi_bil</span> <span class="ow">in</span> <span class="n">ROIs_bil</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;_first&quot;</span><span class="p">,</span> <span class="s2">&quot;_second&quot;</span><span class="p">]:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;TIV_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="n">session</span><span class="p">]</span><span class="o">.</span><span class="n">array</span>
        <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_pred</span>
        <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="n">session</span> <span class="o">+</span> <span class="s2">&quot;_pred&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">residual</span>

    <span class="c1"># calculate change in subcortical volume</span>
    <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_change&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_second_pred&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_first_pred&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># perform additional correction using the averages of the two time points</span>
    <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_meanT1T2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_first_pred&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_second_pred&quot;</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">{roi}</span><span class="s2">_meanT1T2&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">roi</span><span class="o">=</span><span class="n">roi_bil</span><span class="p">)]</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_change&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span>
    <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">residual</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_pred</span>
    <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_change_pred&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">residual</span>

    <span class="c1"># calculate percentage of change</span>
    <span class="c1">#   ROI_data[roi_bil + &quot;_change_pred_pct&quot;] = (</span>
    <span class="c1">#         ((ROI_data[roi_bil + &quot;_second_pred&quot;] - ROI_data[roi_bil + &quot;_first_pred&quot;]) /</span>
    <span class="c1">#             ROI_data[roi_bil + &quot;_first_pred&quot;]) * 100</span>
    <span class="c1">#     )</span>
    <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_change_pred_pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_second&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_first&quot;</span><span class="p">])</span>
        <span class="o">/</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_first&quot;</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># correct the unilateral ROIs volumes by performing a regression over the estimated total intracranial volume</span>

<span class="k">for</span> <span class="n">roi_bil</span> <span class="ow">in</span> <span class="n">ROIs_bil</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Right-&quot;</span><span class="p">,</span> <span class="s2">&quot;Left-&quot;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;_first&quot;</span><span class="p">,</span> <span class="s2">&quot;_second&quot;</span><span class="p">]:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;TIV_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="n">session</span><span class="p">]</span><span class="o">.</span><span class="n">array</span>
            <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">residual</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_pred</span>
            <span class="n">ROI_data</span><span class="p">[</span><span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="n">session</span> <span class="o">+</span> <span class="s2">&quot;_pred&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">residual</span>

        <span class="c1"># calculate change in subcortical volume</span>
        <span class="n">ROI_data</span><span class="p">[</span><span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_change&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ROI_data</span><span class="p">[</span><span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_second_pred&quot;</span><span class="p">]</span>
            <span class="o">-</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_first_pred&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># perform additional correction using the averages of the two time points</span>
        <span class="n">ROI_data</span><span class="p">[</span><span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_meanT1T2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ROI_data</span><span class="p">[</span><span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_first_pred&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_second_pred&quot;</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_meanT1T2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_change&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">array</span>
        <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_pred</span>
        <span class="n">ROI_data</span><span class="p">[</span><span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_change_pred&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">residual</span>


<span class="c1"># calculate cortical thickness change index</span>
<span class="c1"># formula: (Thickness at Time 1 - Thickness at Time 2)/(Time 2 - Time 1)</span>
<span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;durationT2_T1_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;durationT2_T1&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">12</span>
<span class="p">)</span>  <span class="c1"># calculate difference in years</span>
<span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;thickness_change&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;thickness_bil_first&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;thickness_bil_second&quot;</span><span class="p">]</span>
<span class="p">)</span> <span class="o">/</span> <span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;durationT2_T1_y&quot;</span><span class="p">]</span>

<span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;thickness_change_pct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;thickness_bil_second&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;thickness_bil_first&quot;</span><span class="p">])</span>
    <span class="o">/</span> <span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;thickness_bil_first&quot;</span><span class="p">]</span>
<span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Correlation analysis</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">pearsonr</span>

<span class="n">ROIs_bil</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Thalamus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Caudate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Putamen&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Pallidum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Hippocampus&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Amygdala&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Accumbens-area&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">correlation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">yvar</span><span class="p">,</span> <span class="n">xvars</span><span class="p">):</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">yvar</span><span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">xvars</span><span class="p">]</span>
    <span class="p">[</span><span class="n">corr_r</span><span class="p">,</span> <span class="n">corr_p</span><span class="p">]</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">corr_r</span><span class="p">,</span> <span class="n">corr_p</span><span class="p">]</span>


<span class="n">ROI_PDMCI</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PD-MCI&quot;</span><span class="p">]</span>
<span class="n">ROI_PDnonMCI</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PD-non-MCI&quot;</span><span class="p">]</span>
<span class="n">ROI_PDall</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ROI_PDMCI</span><span class="p">,</span> <span class="n">ROI_PDnonMCI</span><span class="p">])</span>
<span class="n">corr</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># MoCA x volume correlation</span>
<span class="k">for</span> <span class="n">roi_bil</span> <span class="ow">in</span> <span class="n">ROIs_bil</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Right-&quot;</span><span class="p">,</span> <span class="s2">&quot;Left-&quot;</span><span class="p">]:</span>
        <span class="p">[</span>
            <span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_&quot;</span> <span class="o">+</span> <span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_MoCA_PDMCI&quot;</span><span class="p">],</span>
            <span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_&quot;</span> <span class="o">+</span> <span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_MoCA_PDMCI&quot;</span><span class="p">],</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">correlation</span><span class="p">(</span>
            <span class="n">ROI_PDMCI</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{s}{roi}</span><span class="s2">_change_pred&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">side</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi_bil</span><span class="p">),</span> <span class="s2">&quot;MCATOT_diff&quot;</span>
        <span class="p">)</span>
        <span class="p">[</span>
            <span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_&quot;</span> <span class="o">+</span> <span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_MoCA_PDnonMCI&quot;</span><span class="p">],</span>
            <span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_&quot;</span> <span class="o">+</span> <span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_MoCA_PDnonMCI&quot;</span><span class="p">],</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">correlation</span><span class="p">(</span>
            <span class="n">ROI_PDnonMCI</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="si">{s}{roi}</span><span class="s2">_change_pred&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">side</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi_bil</span><span class="p">),</span>
            <span class="s2">&quot;MCATOT_diff&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="p">[</span>
            <span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_&quot;</span> <span class="o">+</span> <span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_MoCA_PDall&quot;</span><span class="p">],</span>
            <span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_&quot;</span> <span class="o">+</span> <span class="n">side</span> <span class="o">+</span> <span class="n">roi_bil</span> <span class="o">+</span> <span class="s2">&quot;_MoCA_PDall&quot;</span><span class="p">],</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">correlation</span><span class="p">(</span>
            <span class="n">ROI_PDall</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{s}{roi}</span><span class="s2">_change_pred&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">side</span><span class="p">,</span> <span class="n">roi</span><span class="o">=</span><span class="n">roi_bil</span><span class="p">),</span> <span class="s2">&quot;MCATOT_diff&quot;</span>
        <span class="p">)</span>

<span class="c1"># MoCA x thickness correlation</span>
<span class="p">[</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_thick_MoCA_PDMCI&quot;</span><span class="p">],</span> <span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_thick_MoCA_PDMCI&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">correlation</span><span class="p">(</span>
    <span class="n">ROI_PDMCI</span><span class="p">,</span> <span class="s2">&quot;thickness_change&quot;</span><span class="p">,</span> <span class="s2">&quot;MCATOT_diff&quot;</span>
<span class="p">)</span>
<span class="p">[</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_thick_MoCA_PDnonMCI&quot;</span><span class="p">],</span> <span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_thick_MoCA_PDnonMCI&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">correlation</span><span class="p">(</span>
    <span class="n">ROI_PDnonMCI</span><span class="p">,</span> <span class="s2">&quot;thickness_change&quot;</span><span class="p">,</span> <span class="s2">&quot;MCATOT_diff&quot;</span>
<span class="p">)</span>
<span class="p">[</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_thick_MoCA_PDall&quot;</span><span class="p">],</span> <span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_thick_MoCA_PDall&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">correlation</span><span class="p">(</span>
    <span class="n">ROI_PDall</span><span class="p">,</span> <span class="s2">&quot;thickness_change&quot;</span><span class="p">,</span> <span class="s2">&quot;MCATOT_diff&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check if the original correlation results have been replicated</span>


<span class="k">if</span> <span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Thalamus_MoCA_PDall&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the correlation between MoCA score and right thalamus in PD-all group is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Thalamus_MoCA_PDall&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant correlation between the change of the right thalamus volume and MoCA scores in PD-all has been replicated. The result is significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the correlation between MoCA score and right thalamus in PD-all group is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Thalamus_MoCA_PDall&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant correlation between the change of the right thalamus volume and MoCA scores in PD-all has not been replicated. The result is non-significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Thalamus_MoCA_PDMCI&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the correlation between MoCA score and right thalamus in PD-MCI group is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Thalamus_MoCA_PDMCI&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant correlation between the change of the right thalamus volume and MoCA scores in PD-MCI has been replicated. The result is significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the correlation between MoCA score and right thalamus in PD-MCI group is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Thalamus_MoCA_PDMCI&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant correlation between the change of the right thalamus volume and MoCA scores in PD-MCI has not been replicated. The result is non-significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Amygdala_MoCA_PDall&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the correlation between MoCA score and right amygdala in PD-all group is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Amygdala_MoCA_PDall&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant correlation between the change of the right amygdala volume and MoCA scores in PD-all has been replicated. The result is significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the correlation between MoCA score and right amygdala in PD-all group is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Amygdala_MoCA_PDall&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant correlation between the change of the right amygdala volume and MoCA scores in PD-all has not been replicated. The result is non-significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The p value of the correlation between MoCA score and right thalamus in PD-all group is 0.8861297955138382. The original significant correlation between the change of the right thalamus volume and MoCA scores in PD-all has not been replicated. The result is non-significant.

The p value of the correlation between MoCA score and right thalamus in PD-MCI group is 0.8059076167947397. The original significant correlation between the change of the right thalamus volume and MoCA scores in PD-MCI has not been replicated. The result is non-significant.

The p value of the correlation between MoCA score and right amygdala in PD-all group is 0.2549423489414147. The original significant correlation between the change of the right amygdala volume and MoCA scores in PD-all has not been replicated. The result is non-significant.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group differences in cortical thickness change and subcortical volume change</span>

<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Thalamus_change_pred&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Caudate_change_pred&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Putamen_change_pred&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Pallidum_change_pred&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Hippocampus_change_pred&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Amygdala_change_pred&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Accumbens-area_change_pred&quot;</span><span class="p">,</span>
    <span class="s2">&quot;thickness_change&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">ttest_ind</span>

<span class="n">ROI_PDMCI</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PD-MCI&quot;</span><span class="p">]</span>
<span class="n">ROI_PDnonMCI</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PD-non-MCI&quot;</span><span class="p">]</span>
<span class="n">ROI_HC</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;HC&quot;</span><span class="p">]</span>
<span class="n">ttest</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="p">[</span>
        <span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_t_&quot;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s2">&quot;_PDMCI_HC&quot;</span><span class="p">],</span>
        <span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_&quot;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s2">&quot;_PDMCI_HC&quot;</span><span class="p">],</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">ROI_PDMCI</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">ROI_HC</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
    <span class="p">[</span>
        <span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_t_&quot;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s2">&quot;_PDMCI_PDnonMCI&quot;</span><span class="p">],</span>
        <span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_&quot;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s2">&quot;_PDMCI_PDnonMCI&quot;</span><span class="p">],</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">ROI_PDMCI</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">ROI_PDnonMCI</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
    <span class="p">[</span>
        <span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_t_&quot;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s2">&quot;_PDnonMCI_HC&quot;</span><span class="p">],</span>
        <span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_&quot;</span> <span class="o">+</span> <span class="n">var</span> <span class="o">+</span> <span class="s2">&quot;_PDnonMCI_HC&quot;</span><span class="p">],</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">ttest_ind</span><span class="p">(</span><span class="n">ROI_PDnonMCI</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">ROI_HC</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">cohort_summary</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>

    <span class="n">hc</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;HC&quot;</span><span class="p">]</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PD-non-MCI&quot;</span><span class="p">]</span>
    <span class="n">mci</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[</span><span class="n">ROI_data</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PD-MCI&quot;</span><span class="p">]</span>

    <span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">box</span><span class="o">=</span><span class="n">rich</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">SIMPLE_HEAVY</span><span class="p">,</span> <span class="n">show_footer</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;HC mean&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;HC %&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PD-non-MCI mean&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PD-non-MCI %&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PD-MCI mean&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PD-MCI %&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PD-MCI vs PD-non-MCI&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PD-MCI vs HC&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PD-non-MCI vs HC&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;ROI&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;CoTh&quot;</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;thickness_change&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;thickness_change_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;thickness_change&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;thickness_change_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;thickness_change&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;thickness_change_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_thickness_change_PDMCI_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_thickness_change_PDMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_thickness_change_PDnonMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;Thal&quot;</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;Thalamus_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;Thalamus_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;Thalamus_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;Thalamus_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;Thalamus_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;Thalamus_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Thalamus_change_pred_PDMCI_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Thalamus_change_pred_PDMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Thalamus_change_pred_PDnonMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;Caud&quot;</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;Caudate_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;Caudate_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;Caudate_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;Caudate_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;Caudate_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;Caudate_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Caudate_change_pred_PDMCI_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Caudate_change_pred_PDMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Caudate_change_pred_PDnonMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;Put&quot;</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;Putamen_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;Putamen_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;Putamen_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;Putamen_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;Putamen_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;Putamen_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Putamen_change_pred_PDMCI_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Putamen_change_pred_PDMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Putamen_change_pred_PDnonMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;Hipp&quot;</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;Hippocampus_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;Hippocampus_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;Hippocampus_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;Hippocampus_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;Hippocampus_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;Hippocampus_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Hippocampus_change_pred_PDMCI_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Hippocampus_change_pred_PDMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Hippocampus_change_pred_PDnonMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;Amyg&quot;</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;Amygdala_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;Amygdala_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;Amygdala_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;Amygdala_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;Amygdala_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;Amygdala_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Amygdala_change_pred_PDMCI_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Amygdala_change_pred_PDMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Amygdala_change_pred_PDnonMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
        <span class="s2">&quot;Nacc&quot;</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;Accumbens-area_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">hc</span><span class="p">[</span><span class="s2">&quot;Accumbens-area_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;Accumbens-area_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">nc</span><span class="p">[</span><span class="s2">&quot;Accumbens-area_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;Accumbens-area_change_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">mci</span><span class="p">[</span><span class="s2">&quot;Accumbens-area_change_pred_pct&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span>
            <span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Accumbens-area_change_pred_PDMCI_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Accumbens-area_change_pred_PDMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Accumbens-area_change_pred_PDnonMCI_HC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>
    <span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cohort_summary</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Longitudinal differences between groups</span><span class="se">\n</span><span class="s2"> Mean and percentage of change&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Amyg, amygdala; Caud, caudate; CoTh, cortical thickness; Hipp, hippocampus; Nacc, nucleus accumbens; Put, putamen; Thal, thalamus&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-style: italic">                                      Longitudinal differences between groups                                      </span>
<span style="font-style: italic">                                           Mean and percentage of change                                           </span>
                                                                                                                   
 <span style="font-weight: bold">      </span> <span style="font-weight: bold">         </span> <span style="font-weight: bold">        </span> <span style="font-weight: bold"> PD-non-MCI </span> <span style="font-weight: bold"> PD-non-MCI </span> <span style="font-weight: bold"> PD-MCI     </span> <span style="font-weight: bold">          </span> <span style="font-weight: bold"> PD-MCI vs  </span> <span style="font-weight: bold"> PD-MCI vs </span> <span style="font-weight: bold"> PD-non-MCI </span> 
 <span style="font-weight: bold">      </span> <span style="font-weight: bold"> HC mean </span> <span style="font-weight: bold"> HC %   </span> <span style="font-weight: bold"> mean       </span> <span style="font-weight: bold"> %          </span> <span style="font-weight: bold"> mean       </span> <span style="font-weight: bold"> PD-MCI % </span> <span style="font-weight: bold"> PD-non-MCI </span> <span style="font-weight: bold"> HC        </span> <span style="font-weight: bold"> vs HC      </span> 
 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 
  ROI    mean      %        mean         %            mean         %          p            p           p           
  CoTh   0.006     -0.211   -0.0         -0.114       0.006        -0.57      0.44         1.0         0.5         
  Thal   -51.26    -0.68    210.34       1.25         -223.24      -2.56      0.01         0.28        0.09        
  Caud   -9.36     -0.2     -12.99       -0.25        36.33        0.51       0.63         0.56        0.95        
  Put    -86.9     -0.92    115.21       1.03         -16.38       -0.66      0.21         0.26        0.02        
  Hipp   24.22     -0.49    4.56         -1.14        -50.43       -1.76      0.43         0.22        0.74        
  Amyg   25.98     -0.65    -5.15        -2.24        -39.03       -4.97      0.57         0.2         0.5         
  Nacc   8.04      0.23     -3.06        -0.82        -9.89        -1.23      0.81         0.52        0.58        
 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 
 <span style="font-weight: bold">      </span> <span style="font-weight: bold">         </span> <span style="font-weight: bold">        </span> <span style="font-weight: bold">            </span> <span style="font-weight: bold">            </span> <span style="font-weight: bold">            </span> <span style="font-weight: bold">          </span> <span style="font-weight: bold">            </span> <span style="font-weight: bold">           </span> <span style="font-weight: bold">            </span> 
                                                                                                                   
</pre>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Amyg, amygdala; Caud, caudate; CoTh, cortical thickness; Hipp, hippocampus; Nacc, nucleus accumbens; Put, putamen; Thal, thalamus
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check if the original results have been replicated</span>


<span class="k">if</span> <span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_thickness_change_PDMCI_HC&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the difference in cortical thinkness change between PD-MCI and HC is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_thickness_change_PDMCI_HC&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant difference has been replicated. The result is significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the difference in cortical thinkness change between PD-MCI and HC is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_thickness_change_PDMCI_HC&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant difference has not been replicated. The result is non-significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_thickness_change_PDMCI_PDnonMCI&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the difference in cortical thinkness change between PD-MCI and PD-non-MCI is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_thickness_change_PDMCI_PDnonMCI&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant difference has been replicated. The result is significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the difference in cortical thinkness change between PD-MCI and PD-non-MCI is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_thickness_change_PDMCI_PDnonMCI&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant difference has not been replicated. The result is non-significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Amygdala_change_pred_PDMCI_HC&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the difference in change of the bilateral amygdala volume between PD-MCI and HC is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Amygdala_change_pred_PDMCI_HC&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant difference has been replicated. The result is significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the difference in change of the bilateral amygdala volume between PD-MCI and HC is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Amygdala_change_pred_PDMCI_HC&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant difference has not been replicated. The result is non-significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Amygdala_change_pred_PDMCI_PDnonMCI&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the difference in change of the bilateral amygdala volume between PD-MCI and PD-non-MCI is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Amygdala_change_pred_PDMCI_PDnonMCI&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant difference has been replicated. The result is significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the difference in change of the bilateral amygdala volume between PD-MCI and PD-non-MCI is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Amygdala_change_pred_PDMCI_PDnonMCI&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant difference has not been replicated. The result is non-significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>

<span class="k">if</span> <span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Accumbens-area_change_pred_PDMCI_HC&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the difference in change of the bilateral nucleus accumbens volume between PD-MCI and HC is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Accumbens-area_change_pred_PDMCI_HC&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant difference has been replicated. The result is significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;The p value of the difference in change of the bilateral nucleus accumbens volume between PD-MCI and HC is &quot;</span>
        <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ttest</span><span class="p">[</span><span class="s2">&quot;ttest_p_Accumbens-area_change_pred_PDMCI_HC&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;. The original significant difference has not been replicated. The result is non-significant.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The p value of the difference in cortical thinkness change between PD-MCI and HC is 0.9979758052157945. The original significant difference has not been replicated. The result is non-significant.

The p value of the difference in cortical thinkness change between PD-MCI and PD-non-MCI is 0.44316857788867625. The original significant difference has not been replicated. The result is non-significant.

The p value of the difference in change of the bilateral amygdala volume between PD-MCI and HC is 0.20002293252735706. The original significant difference has not been replicated. The result is non-significant.

The p value of the difference in change of the bilateral amygdala volume between PD-MCI and PD-non-MCI is 0.5742146221493709. The original significant difference has not been replicated. The result is non-significant.

The p value of the difference in change of the bilateral nucleus accumbens volume between PD-MCI and HC is 0.5201460743279115. The original significant difference has not been replicated. The result is non-significant.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Correlation between volumes differences of subcortical segmentations at Times 1 and 2 with MoCA scores differences at Times 1 and 2&quot;</span>
<span class="p">)</span>

<span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;Subcortical segmentations&quot;</span><span class="p">,</span> <span class="n">justify</span><span class="o">=</span><span class="s2">&quot;Left&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PD-All&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PC-MCA&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;PC-non-MCI&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">)</span>

<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;R Thalamus&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Thalamus_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Thalamus_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Thalamus_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Thalamus_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Thalamus_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Thalamus_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;R Caudate&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Caudate_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Caudate_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Caudate_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Caudate_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Caudate_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Caudate_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;R Putamen&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Putamen_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Putamen_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Putamen_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Putamen_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Putamen_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Putamen_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;R Pallidum&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Pallidum_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Pallidum_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Pallidum_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Pallidum_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Pallidum_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Pallidum_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;R Hippocampus&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Hippocampus_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Hippocampus_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Hippocampus_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Hippocampus_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Hippocampus_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Hippocampus_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;R Amygdala&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Amygdala_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Amygdala_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Amygdala_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Amygdala_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Amygdala_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Amygdala_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;R Nucleus accumbens&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Accumbens-area_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Accumbens-area_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Accumbens-area_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Accumbens-area_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Right-Accumbens-area_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Right-Accumbens-area_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>

<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;L Thalamus&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Thalamus_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Thalamus_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Thalamus_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Thalamus_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Thalamus_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Thalamus_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;L Caudate&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Caudate_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Caudate_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Caudate_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Caudate_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Caudate_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Caudate_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;L Putamen&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Putamen_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Putamen_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Putamen_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Putamen_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Putamen_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Putamen_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;L Pallidum&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Pallidum_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Pallidum_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Pallidum_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Pallidum_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Pallidum_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Pallidum_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;L Hippocampus&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Hippocampus_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Hippocampus_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Hippocampus_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Hippocampus_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Hippocampus_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Hippocampus_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;L Amygdala&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Amygdala_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Amygdala_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Amygdala_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Amygdala_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Amygdala_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Amygdala_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
    <span class="s2">&quot;L Nucleus accumbens&quot;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Accumbens-area_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Accumbens-area_MoCA_PDall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Accumbens-area_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Accumbens-area_MoCA_PDMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_r_Left-Accumbens-area_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="s2">&quot;corr_p_Left-Accumbens-area_MoCA_PDnonMCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>


<span class="n">console</span> <span class="o">=</span> <span class="n">Console</span><span class="p">()</span>
<span class="n">console</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-style: italic">Correlation between volumes differences of subcortical segmentations at Times 1 and </span>
<span style="font-style: italic">                  2 with MoCA scores differences at Times 1 and 2                   </span>
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━┓
┃<span style="font-weight: bold"> Subcortical segmentations </span>┃<span style="font-weight: bold"> PD-All </span>┃<span style="font-weight: bold">       </span>┃<span style="font-weight: bold"> PC-MCA </span>┃<span style="font-weight: bold">       </span>┃<span style="font-weight: bold"> PC-non-MCI </span>┃<span style="font-weight: bold">       </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━┩
│                           │ r      │ p     │ r      │ p     │ r          │ p     │
│ R Thalamus                │ -0.03  │ 0.886 │ 0.089  │ 0.806 │ 0.07       │ 0.803 │
│ R Caudate                 │ 0.088  │ 0.676 │ -0.184 │ 0.61  │ 0.284      │ 0.305 │
│ R Putamen                 │ 0.022  │ 0.918 │ 0.141  │ 0.697 │ 0.098      │ 0.728 │
│ R Pallidum                │ -0.0   │ 1.0   │ -0.074 │ 0.839 │ 0.334      │ 0.224 │
│ R Hippocampus             │ -0.099 │ 0.639 │ -0.037 │ 0.92  │ -0.054     │ 0.848 │
│ R Amygdala                │ -0.237 │ 0.255 │ -0.253 │ 0.481 │ -0.27      │ 0.331 │
│ R Nucleus accumbens       │ 0.035  │ 0.868 │ 0.384  │ 0.273 │ -0.123     │ 0.661 │
│ L Thalamus                │ 0.186  │ 0.374 │ 0.135  │ 0.711 │ 0.483      │ 0.068 │
│ L Caudate                 │ -0.0   │ 1.0   │ -0.286 │ 0.424 │ 0.417      │ 0.123 │
│ L Putamen                 │ -0.027 │ 0.898 │ -0.173 │ 0.633 │ 0.189      │ 0.501 │
│ L Pallidum                │ 0.052  │ 0.806 │ 0.015  │ 0.968 │ 0.145      │ 0.607 │
│ L Hippocampus             │ -0.012 │ 0.955 │ -0.082 │ 0.822 │ 0.067      │ 0.814 │
│ L Amygdala                │ 0.235  │ 0.257 │ 0.323  │ 0.363 │ 0.336      │ 0.22  │
│ L Nucleus accumbens       │ 0.022  │ 0.917 │ -0.07  │ 0.848 │ 0.122      │ 0.666 │
└───────────────────────────┴────────┴───────┴────────┴───────┴────────────┴───────┘
</pre>
</div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vertex-wise-analysis">
<h1>Vertex-wise analysis<a class="headerlink" href="#vertex-wise-analysis" title="Link to this heading">#</a></h1>
<section id="prepare-the-vertex-data-with-long-mris-slopes-for-longitudinal-two-stage-model">
<h2>Prepare the vertex data with long_mris_slopes for longitudinal two stage model<a class="headerlink" href="#prepare-the-vertex-data-with-long-mris-slopes-for-longitudinal-two-stage-model" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare node for computation. it includes downloading the container</span>
<span class="c1"># this should be run on a server connected to the internet</span>
<span class="c1"># load recon-all base descriptor</span>

<span class="o">!</span><span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>singularity

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>

<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7378416&quot;</span>
<span class="c1"># bosh([&quot;exec&quot;, &quot;prepare&quot;, zid])</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">boutiques</span><span class="o">.</span><span class="n">descriptor2func</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>zsh:1: command not found: module
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create longitudinal QDEC table</span>

<span class="n">ROI_data_dup</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">ROI_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">ROI_data_dup</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="o">.</span><span class="n">columns</span>
<span class="n">qdec_table</span> <span class="o">=</span> <span class="n">ROI_data_dup</span><span class="p">[[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;dx_group&quot;</span><span class="p">]]</span>
<span class="n">qdec_table</span><span class="p">[</span><span class="s2">&quot;fsid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qdec_table</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">qdec_table</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;_first&quot;</span><span class="p">,</span> <span class="s2">&quot;_second&quot;</span>
<span class="p">)</span>
<span class="n">qdec_table</span><span class="p">[</span><span class="s2">&quot;fsid-base&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qdec_table</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_base&quot;</span>
<span class="n">qdec_table</span><span class="p">[</span><span class="s2">&quot;years&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">qdec_table</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ROI_data_dup</span><span class="p">[</span><span class="s2">&quot;durationT2_T1_y&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">qdec_table</span> <span class="o">=</span> <span class="n">qdec_table</span><span class="p">[[</span><span class="s2">&quot;fsid&quot;</span><span class="p">,</span> <span class="s2">&quot;fsid-base&quot;</span><span class="p">,</span> <span class="s2">&quot;years&quot;</span><span class="p">,</span> <span class="s2">&quot;dx_group&quot;</span><span class="p">]]</span>
<span class="n">qdec_table</span>

<span class="n">qdec_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;qdec_long_groups.dat&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> preprocess_FS_long_mris_slopes.py

<span class="c1"># Prepare the data with long_mris_slopes for longitudinal two stage model</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>
<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7378416&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques.descriptor2func</span><span class="w"> </span><span class="kn">import</span> <span class="n">function</span>
<span class="c1">#bosh([&quot;exec&quot;, &quot;prepare&quot;, zid])</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>


<span class="k">for</span> <span class="n">hemi</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]:</span>
    <span class="n">out_fs</span> <span class="o">=</span> <span class="n">freesurfer</span><span class="p">(</span><span class="s1">&#39;--imagepath&#39;</span><span class="p">,</span> <span class="s1">&#39;freesurfer-freesurfer-7.1.1.simg.tmp&#39;</span><span class="p">,</span>
                                        <span class="n">qdec</span><span class="o">=</span><span class="s1">&#39;qdec_long_groups.dat&#39;</span><span class="p">,</span>
                                        <span class="n">meas</span><span class="o">=</span><span class="s1">&#39;thickness&#39;</span><span class="p">,</span>
                                        <span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">,</span>
                                        <span class="n">time</span><span class="o">=</span><span class="s1">&#39;years&#39;</span><span class="p">,</span>
                                        <span class="n">license</span><span class="o">=</span><span class="s2">&quot;FS_license/license.txt&quot;</span><span class="p">,</span>
                                        <span class="n">stack_avg</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{hemi}</span><span class="s1">.long.thickness-avg.stack.mgh&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span>
                                        <span class="n">stack_rate</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{hemi}</span><span class="s1">.long.thickness-rate.stack.mgh&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span>
                                        <span class="n">stack_pc1fit</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{hemi}</span><span class="s1">.long.thickness-pc1fit.stack.mgh&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span>
                                        <span class="n">stack_pc1</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{hemi}</span><span class="s1">.long.thickness-pc1.stack.mgh&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span>
                                        <span class="n">stack_spc</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{hemi}</span><span class="s1">.long.thickness-spc.stack.mgh&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span>
                                       <span class="p">)</span>


    <span class="n">exitcode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_fs</span><span class="o">.</span><span class="n">exit_code</span><span class="p">)</span>


    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;preproc_FS_codes/exitcode_long_mris_slopes_</span><span class="si">{hemi}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exitcode</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sbatch</span>
#!/bin/bash
#SBATCH --job-name=FS_mris_slopes
#SBATCH --mem=4G
#SBATCH --cpus-per-task=2
#SBATCH --nodes=1
#SBATCH --output=FS_mris_slopes.out
#SBATCH --error=FS_mris_slopes.err
#SBATCH --time=10:0:0

. venv/bin/activate # opens virtual environment. change depending where you proprocess the data  

module load singularity

python preprocess_FS_long_mris_slopes.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-fsgd-file-for-the-correlational-analysis">
<h2>Create FSGD file for the correlational analysis<a class="headerlink" href="#create-fsgd-file-for-the-correlational-analysis" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fsgd_cortThick_mcat</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;durationT2_T1_y&quot;</span><span class="p">,</span> <span class="s2">&quot;dx_group&quot;</span><span class="p">,</span> <span class="s2">&quot;MCATOT_diff&quot;</span><span class="p">]]</span>
<span class="n">fsgd_cortThick_mcat</span><span class="p">[</span><span class="s2">&quot;Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Input&quot;</span>
<span class="n">fsgd_cortThick_mcat</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fsgd_cortThick_mcat</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_base&quot;</span>
<span class="n">fsgd_cortThick_mcat</span> <span class="o">=</span> <span class="n">fsgd_cortThick_mcat</span><span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;Input&quot;</span><span class="p">,</span> <span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;dx_group&quot;</span><span class="p">,</span> <span class="s2">&quot;durationT2_T1_y&quot;</span><span class="p">,</span> <span class="s2">&quot;MCATOT_diff&quot;</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">fsgd_cortThick_mcat</span>

<span class="n">fsgd_cortThick_mcat_PDMCI</span> <span class="o">=</span> <span class="n">fsgd_cortThick_mcat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">fsgd_cortThick_mcat</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PD-MCI&quot;</span>
<span class="p">]</span>
<span class="n">fsgd_cortThick_mcat_PDMCI</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PDMCI&quot;</span>
<span class="n">fsgd_cortThick_mcat_PDnonMCI</span> <span class="o">=</span> <span class="n">fsgd_cortThick_mcat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">fsgd_cortThick_mcat</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PD-non-MCI&quot;</span>
<span class="p">]</span>
<span class="n">fsgd_cortThick_mcat_PDnonMCI</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PDnonMCI&quot;</span>
<span class="n">fsgd_cortThick_mcat_PDall</span> <span class="o">=</span> <span class="n">fsgd_cortThick_mcat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">fsgd_cortThick_mcat</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;PD-MCI&quot;</span><span class="p">,</span> <span class="s2">&quot;PD-non-MCI&quot;</span><span class="p">])</span>
<span class="p">]</span>
<span class="n">fsgd_cortThick_mcat_PDall</span><span class="p">[</span><span class="s2">&quot;dx_group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PDall&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate fsgd files for correlational analysis</span>
<span class="c1"># make sure that the order of subjects in each FSGD file is the same as in long.qdec table</span>

<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PDMCI&quot;</span><span class="p">,</span> <span class="s2">&quot;PDnonMCI&quot;</span><span class="p">,</span> <span class="s2">&quot;PDall&quot;</span><span class="p">]:</span>

    <span class="c1"># generate sample matrix</span>
    <span class="n">exec</span><span class="p">(</span>
        <span class="s2">&quot;fsgd_cortThick_mcat_</span><span class="si">%s</span><span class="s2">.to_csv(&#39;fsgd_corr_</span><span class="si">%s</span><span class="s2">_cort.txt&#39;, sep=&#39;</span><span class="se">\t</span><span class="s2">&#39;, index=False, header=None)&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># generate file header</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fsgd_corr_</span><span class="si">{group}</span><span class="s2">_desc.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s2">&quot;GroupDescriptorFile 1</span><span class="se">\n</span><span class="s2">Title GroupDifferences</span><span class="se">\n</span><span class="s2">MeasurementName MoCA</span><span class="se">\n</span><span class="s2">Class </span><span class="si">{group}</span><span class="se">\n</span><span class="s2">Variables durationT2_T1_y MoCA</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">group</span><span class="o">=</span><span class="n">group</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># generate fsgd file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fsgd_corr_</span><span class="si">{group}</span><span class="s2">_group.fsgd&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">),</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;fsgd_corr_</span><span class="si">{group}</span><span class="s2">_desc.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">),</span>
            <span class="s2">&quot;fsgd_corr_</span><span class="si">{group}</span><span class="s2">_cort.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">),</span>
        <span class="p">]:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="stack-images-for-correlational-analyses">
<h2>Stack images for correlational analyses<a class="headerlink" href="#stack-images-for-correlational-analyses" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># prepare node for computation. it includes downloading the container</span>
<span class="c1"># this should be run on a server connected to the internet</span>
<span class="c1"># load recon-all base descriptor</span>

<span class="o">!</span><span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>singularity

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>

<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7387748&quot;</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">boutiques</span><span class="o">.</span><span class="n">descriptor2func</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> preprocess_FS_mris_preproc_corr.py

<span class="c1"># Concatenate images from correlation analysis</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>
<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7387748&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques.descriptor2func</span><span class="w"> </span><span class="kn">import</span> <span class="n">function</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>


<span class="k">for</span> <span class="n">hemi</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PDMCI&quot;</span><span class="p">,</span> <span class="s2">&quot;PDnonMCI&quot;</span><span class="p">,</span> <span class="s2">&quot;PDall&quot;</span><span class="p">]:</span>
        <span class="n">out_fs</span> <span class="o">=</span> <span class="n">freesurfer</span><span class="p">(</span><span class="s1">&#39;--imagepath&#39;</span><span class="p">,</span> <span class="s1">&#39;freesurfer-freesurfer-7.1.1.simg.tmp&#39;</span><span class="p">,</span>
                                        <span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">,</span>
                                        <span class="n">license</span><span class="o">=</span><span class="s2">&quot;FS_license/license.txt&quot;</span><span class="p">,</span>
                                        <span class="n">cachein</span><span class="o">=</span><span class="s2">&quot;long.thickness-rate.fwhm10.fsaverage&quot;</span><span class="p">,</span>
                                        <span class="n">target</span><span class="o">=</span><span class="s2">&quot;fsaverage&quot;</span><span class="p">,</span>
                                        <span class="n">fsgd</span><span class="o">=</span><span class="s1">&#39;fsgd_corr_</span><span class="si">{group}</span><span class="s1">_group.fsgd&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">),</span>
                                        <span class="n">out</span><span class="o">=</span><span class="s1">&#39;stack.</span><span class="si">{hemi}</span><span class="s1">.corr.</span><span class="si">{group}</span><span class="s1">.thickness.rate.10.mgh&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">),</span>
                                       <span class="p">)</span>


    <span class="n">exitcode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_fs</span><span class="o">.</span><span class="n">exit_code</span><span class="p">)</span>


    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;preproc_FS_codes/exitcode_mris_preproc_</span><span class="si">{hemi}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exitcode</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sbatch</span>
#!/bin/bash
#SBATCH --job-name=FS_mris_preproc_corr
#SBATCH --mem=1G
#SBATCH --cpus-per-task=2
#SBATCH --nodes=1
#SBATCH --output=FS_mris_preproc_corr.out
#SBATCH --error=FS_mris_preproc_corr.err
#SBATCH --time=0:30:0

. venv/bin/activate # opens virtual environment. change depending where you proprocess the data  

module load singularity

python preprocess_FS_mris_preproc_corr.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-fsgd-file-for-the-group-analysis">
<h2>Create FSGD file for the group analysis<a class="headerlink" href="#create-fsgd-file-for-the-group-analysis" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fsgd_cortThick_diff</span> <span class="o">=</span> <span class="n">ROI_data</span><span class="p">[[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;durationT2_T1_y&quot;</span><span class="p">,</span> <span class="s2">&quot;dx_group&quot;</span><span class="p">]]</span>
<span class="n">fsgd_cortThick_diff</span><span class="p">[</span><span class="s2">&quot;Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Input&quot;</span>
<span class="n">fsgd_cortThick_diff</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fsgd_cortThick_diff</span><span class="p">[</span><span class="s2">&quot;PATNO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_base&quot;</span>
<span class="n">fsgd_cortThick_diff</span> <span class="o">=</span> <span class="n">fsgd_cortThick_diff</span><span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;Input&quot;</span><span class="p">,</span> <span class="s2">&quot;PATNO&quot;</span><span class="p">,</span> <span class="s2">&quot;dx_group&quot;</span><span class="p">,</span> <span class="s2">&quot;durationT2_T1_y&quot;</span><span class="p">]</span>
<span class="p">]</span>


<span class="c1"># generate sample matrix</span>
<span class="n">fsgd_cortThick_diff</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;fsgd_group_cort.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># generate file header</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fsgd_group_desc.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="s2">&quot;GroupDescriptorFile 1</span><span class="se">\n</span><span class="s2">Title GroupDifferences</span><span class="se">\n</span><span class="s2">Class PD-MCI</span><span class="se">\n</span><span class="s2">Class PD-non-MCI</span><span class="se">\n</span><span class="s2">Class HC</span><span class="se">\n</span><span class="s2">Variables durationT2_T1_y</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fsgd_cort_group.fsgd&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fsgd_group_desc.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;fsgd_group_cort.txt&quot;</span><span class="p">]:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
            <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="c1"># make sure that the order of subjects in FSGD file is the same as in long.qdec table</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="stack-images-for-group-analyses">
<h2>Stack images for group analyses<a class="headerlink" href="#stack-images-for-group-analyses" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> preprocess_FS_mris_preproc_group.py

<span class="c1"># Concatenate images from group analysis</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>
<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7387748&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques.descriptor2func</span><span class="w"> </span><span class="kn">import</span> <span class="n">function</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>


<span class="k">for</span> <span class="n">hemi</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]:</span>
    <span class="n">out_fs</span> <span class="o">=</span> <span class="n">freesurfer</span><span class="p">(</span><span class="s1">&#39;--imagepath&#39;</span><span class="p">,</span> <span class="s1">&#39;freesurfer-freesurfer-7.1.1.simg.tmp&#39;</span><span class="p">,</span>
                                        <span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">,</span>
                                        <span class="n">license</span><span class="o">=</span><span class="s2">&quot;FS_license/license.txt&quot;</span><span class="p">,</span>
                                        <span class="n">cachein</span><span class="o">=</span><span class="s2">&quot;long.thickness-rate.fwhm10.fsaverage&quot;</span><span class="p">,</span>
                                        <span class="n">target</span><span class="o">=</span><span class="s2">&quot;fsaverage&quot;</span><span class="p">,</span>
                                        <span class="n">fsgd</span><span class="o">=</span><span class="s1">&#39;fsgd_cort_group.fsgd&#39;</span><span class="p">,</span>
                                        <span class="n">out</span><span class="o">=</span><span class="s1">&#39;stack.</span><span class="si">{hemi}</span><span class="s1">.group.thickness.rate.10.mgh&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span>
                                       <span class="p">)</span>


    <span class="n">exitcode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_fs</span><span class="o">.</span><span class="n">exit_code</span><span class="p">)</span>


    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;preproc_FS_codes/exitcode_mris_preproc_group_</span><span class="si">{hemi}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exitcode</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sbatch</span>
#!/bin/bash
#SBATCH --job-name=FS_mris_preproc_group
#SBATCH --mem=1G
#SBATCH --cpus-per-task=2
#SBATCH --nodes=1
#SBATCH --output=FS_mris_preproc_group.out
#SBATCH --error=FS_mris_preproc_group.err
#SBATCH --time=0:10:0

. venv/bin/activate # opens virtual environment. change depending where you proprocess the data  

module load singularity

python preprocess_FS_mris_preproc_group.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-glm-model-for-the-correlational-analysis">
<h2>Run GLM model for the correlational analysis<a class="headerlink" href="#run-glm-model-for-the-correlational-analysis" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create contrast for MoCA scores</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;con_corr_MoCA.mtx&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0 0 1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> glm_corr.py

<span class="c1"># GLM model for the correlational analysis</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>
<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7411854&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques.descriptor2func</span><span class="w"> </span><span class="kn">import</span> <span class="n">function</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>


<span class="k">for</span> <span class="n">hemi</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PDMCI&quot;</span><span class="p">,</span> <span class="s2">&quot;PDnonMCI&quot;</span><span class="p">,</span> <span class="s2">&quot;PDall&quot;</span><span class="p">]:</span>   
        <span class="n">out_fs</span> <span class="o">=</span> <span class="n">freesurfer</span><span class="p">(</span><span class="s1">&#39;--imagepath&#39;</span><span class="p">,</span> <span class="s1">&#39;freesurfer-freesurfer-7.1.1.simg.tmp&#39;</span><span class="p">,</span>
                                        <span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">,</span>
                                        <span class="n">license</span><span class="o">=</span><span class="s2">&quot;FS_license/license.txt&quot;</span><span class="p">,</span>
                                        <span class="n">outdir</span><span class="o">=</span><span class="s1">&#39;results_corr_</span><span class="si">{group}</span><span class="s1">_</span><span class="si">{hemi}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span>
                                        <span class="n">inputdata</span><span class="o">=</span><span class="s1">&#39;stack.</span><span class="si">{hemi}</span><span class="s1">.corr.</span><span class="si">{group}</span><span class="s1">.thickness.rate.10.mgh&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">),</span>
                                        <span class="n">fsgd</span><span class="o">=</span><span class="s1">&#39;fsgd_corr_</span><span class="si">{group}</span><span class="s1">_group.fsgd&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">),</span>
                                        <span class="n">con</span><span class="o">=</span><span class="s1">&#39;con_corr_MoCA.mtx&#39;</span>
                                       <span class="p">)</span>


    <span class="n">exitcode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_fs</span><span class="o">.</span><span class="n">exit_code</span><span class="p">)</span>


    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;preproc_FS_codes/exitcode_glm_corr_</span><span class="si">{group}</span><span class="s1">_</span><span class="si">{hemi}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exitcode</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sbatch</span>
#!/bin/bash
#SBATCH --job-name=glm_corr
#SBATCH --mem=1G
#SBATCH --cpus-per-task=2
#SBATCH --nodes=1
#SBATCH --output=FS_glm_corr.out
#SBATCH --error=FS_glm_corr.err
#SBATCH --time=0:10:0

. venv/bin/activate # opens virtual environment. change depending where you proprocess the data  

module load singularity

python glm_corr.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-glm-model-for-the-group-analysis">
<h2>Run GLM model for the group analysis<a class="headerlink" href="#run-glm-model-for-the-group-analysis" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create group contrasts</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;con_group_PDMCI_PDnonMCI.mtx&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;1 -1 0 0 0 0&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;con_group_PDMCI_HC.mtx&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;1 0 -1 0 0 0&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;con_group_PDnonMCI_HC.mtx&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0 1 -1 0 0 0&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> glm_group.py

<span class="c1"># GLM model for the group analysis</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>
<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7411856&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques.descriptor2func</span><span class="w"> </span><span class="kn">import</span> <span class="n">function</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>


<span class="k">for</span> <span class="n">hemi</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]:</span>  
    <span class="n">out_fs</span> <span class="o">=</span> <span class="n">freesurfer</span><span class="p">(</span><span class="s1">&#39;--imagepath&#39;</span><span class="p">,</span> <span class="s1">&#39;freesurfer-freesurfer-7.1.1.simg.tmp&#39;</span><span class="p">,</span>
                                        <span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">,</span>
                                        <span class="n">license</span><span class="o">=</span><span class="s2">&quot;FS_license/license.txt&quot;</span><span class="p">,</span>
                                        <span class="n">outdir</span><span class="o">=</span><span class="s1">&#39;results_group_</span><span class="si">{hemi}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span>
                                        <span class="n">inputdata</span><span class="o">=</span><span class="s1">&#39;stack.</span><span class="si">{hemi}</span><span class="s1">.group.thickness.rate.10.mgh&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span>
                                        <span class="n">fsgd</span><span class="o">=</span><span class="s1">&#39;fsgd_cort_group.fsgd&#39;</span><span class="p">,</span>
                                        <span class="n">con1</span><span class="o">=</span><span class="s2">&quot;con_group_PDMCI_PDnonMCI.mtx&quot;</span><span class="p">,</span> 
                                        <span class="n">con2</span><span class="o">=</span><span class="s2">&quot;con_group_PDMCI_HC.mtx&quot;</span><span class="p">,</span> 
                                        <span class="n">con3</span><span class="o">=</span><span class="s2">&quot;con_group_PDnonMCI_HC.mtx&quot;</span>
                                       <span class="p">)</span>


    <span class="n">exitcode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_fs</span><span class="o">.</span><span class="n">exit_code</span><span class="p">)</span>


    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;preproc_FS_codes/exitcode_glm_group_</span><span class="si">{hemi}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exitcode</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sbatch</span>
#!/bin/bash
#SBATCH --job-name=glm_group
#SBATCH --mem=1G
#SBATCH --cpus-per-task=2
#SBATCH --nodes=1
#SBATCH --output=FS_glm_group.out
#SBATCH --error=FS_glm_group.err
#SBATCH --time=0:10:0

. venv/bin/activate # opens virtual environment. change depending where you proprocess the data  

module load singularity

python glm_group.py
</pre></div>
</div>
</div>
</div>
</section>
<section id="correction-for-multiple-comparison-with-mri-glmfit-sim">
<h2>Correction for multiple comparison (with mri_glmfit-sim)<a class="headerlink" href="#correction-for-multiple-comparison-with-mri-glmfit-sim" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> glm_group_sim.py

<span class="c1"># GLM model for the group analysis</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>
<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7411893&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques.descriptor2func</span><span class="w"> </span><span class="kn">import</span> <span class="n">function</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>


<span class="k">for</span> <span class="n">hemi</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]:</span>  
    <span class="n">out_fs</span> <span class="o">=</span> <span class="n">freesurfer</span><span class="p">(</span><span class="s1">&#39;--imagepath&#39;</span><span class="p">,</span> <span class="s1">&#39;freesurfer-freesurfer-7.1.1.simg.tmp&#39;</span><span class="p">,</span>
                                        <span class="n">license</span><span class="o">=</span><span class="s2">&quot;FS_license/license.txt&quot;</span><span class="p">,</span>
                                        <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;results_group_</span><span class="si">{hemi}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span>
                                        <span class="n">CACHE_abs</span><span class="o">=</span><span class="s1">&#39;1.3&#39;</span><span class="p">,</span>
                                        <span class="n">cwp</span><span class="o">=</span><span class="s2">&quot;0.05&quot;</span>
                                       <span class="p">)</span>


    <span class="n">exitcode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_fs</span><span class="o">.</span><span class="n">exit_code</span><span class="p">)</span>


    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;preproc_FS_codes/exitcode_glm_sim_group_</span><span class="si">{hemi}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exitcode</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sbatch</span>
#!/bin/bash
#SBATCH --job-name=glm_group_sim
#SBATCH --mem=1G
#SBATCH --cpus-per-task=2
#SBATCH --nodes=1
#SBATCH --output=FS_glm_sim_group.out
#SBATCH --error=FS_glm_sim_group.err
#SBATCH --time=0:10:0

. venv/bin/activate # opens virtual environment. change depending where you proprocess the data  

module load singularity

python glm_group_sim.py
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> glm_corr_sim.py

<span class="c1"># GLM model for the correlational analysis</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">boutiques</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques</span><span class="w"> </span><span class="kn">import</span> <span class="n">bosh</span>
<span class="n">zid</span> <span class="o">=</span> <span class="s2">&quot;zenodo.7411893&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">boutiques.descriptor2func</span><span class="w"> </span><span class="kn">import</span> <span class="n">function</span>
<span class="n">freesurfer</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">zid</span><span class="p">)</span>


<span class="k">for</span> <span class="n">hemi</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PDMCI&quot;</span><span class="p">,</span> <span class="s2">&quot;PDnonMCI&quot;</span><span class="p">,</span> <span class="s2">&quot;PDall&quot;</span><span class="p">]:</span> 
        <span class="n">out_fs</span> <span class="o">=</span> <span class="n">freesurfer</span><span class="p">(</span><span class="s1">&#39;--imagepath&#39;</span><span class="p">,</span> <span class="s1">&#39;freesurfer-freesurfer-7.1.1.simg.tmp&#39;</span><span class="p">,</span>
                                        <span class="n">license</span><span class="o">=</span><span class="s2">&quot;FS_license/license.txt&quot;</span><span class="p">,</span>
                                        <span class="nb">dir</span><span class="o">=</span><span class="s1">&#39;results_corr_</span><span class="si">{group}</span><span class="s1">_</span><span class="si">{hemi}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span>
                                        <span class="n">CACHE_abs</span><span class="o">=</span><span class="s1">&#39;1.3&#39;</span><span class="p">,</span>
                                        <span class="n">cwp</span><span class="o">=</span><span class="s2">&quot;0.05&quot;</span>
                                       <span class="p">)</span>


    <span class="n">exitcode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_fs</span><span class="o">.</span><span class="n">exit_code</span><span class="p">)</span>


    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;preproc_FS_codes/exitcode_glm_sim_corr_</span><span class="si">{group}</span><span class="s1">_</span><span class="si">{hemi}</span><span class="s1">.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exitcode</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sbatch</span>
#!/bin/bash
#SBATCH --job-name=glm_corr_sim
#SBATCH --mem=1G
#SBATCH --cpus-per-task=2
#SBATCH --nodes=1
#SBATCH --output=FS_glm_sim_corr.out
#SBATCH --error=FS_glm_sim_corr.err
#SBATCH --time=0:10:0

. venv/bin/activate # opens virtual environment. change depending where you proprocess the data  

module load singularity

python glm_corr_sim.py
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vertex-wise-results">
<h1>Vertex-wise results<a class="headerlink" href="#vertex-wise-results" title="Link to this heading">#</a></h1>
<section id="correlation-with-moca">
<h2>correlation with MoCA<a class="headerlink" href="#correlation-with-moca" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># correlation results</span>

<span class="n">result_corr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;result_corr.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

<span class="c1"># print(&quot;Correlation analysis&quot;)</span>
<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PDMCI&quot;</span><span class="p">,</span> <span class="s2">&quot;PDnonMCI&quot;</span><span class="p">,</span> <span class="s2">&quot;PDall&quot;</span><span class="p">]:</span>
    <span class="c1"># print(&quot;Significant correlation with MoCA in {group} group\n&quot;.format(group=group))</span>
    <span class="k">for</span> <span class="n">hemi</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]:</span>
        <span class="c1"># print(&quot;Hemisphere {hemi}\n&quot;.format(hemi=hemi))</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
            <span class="s2">&quot;results_corr_</span><span class="si">{group}</span><span class="s2">_</span><span class="si">{hemi}</span><span class="s2">/con_corr_MoCA/cache.th13.abs.sig.cluster.summary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span>
            <span class="p">),</span>
            <span class="s2">&quot;r&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">always_print</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">result_corr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">group</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">hemi</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">always_print</span> <span class="ow">or</span> <span class="s2">&quot;ClusterNo&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="c1"># print(line)</span>
                <span class="n">result_corr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">always_print</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_corr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;result_corr.txt&quot;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">s+&quot;</span><span class="p">,</span>
    <span class="n">keep_default_na</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">na_values</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;ClusterNo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Max&quot;</span><span class="p">,</span>
        <span class="s2">&quot;VtxMax&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Size(mm^2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MNIX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MNIY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MNIZ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CWP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CWPLow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CWPHi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NVtxs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WghtVtx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Annot&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">results_corr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ClusterNo</th>
      <th>Max</th>
      <th>VtxMax</th>
      <th>Size(mm^2)</th>
      <th>MNIX</th>
      <th>MNIY</th>
      <th>MNIZ</th>
      <th>CWP</th>
      <th>CWPLow</th>
      <th>CWPHi</th>
      <th>NVtxs</th>
      <th>WghtVtx</th>
      <th>Annot</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>PDMCI_lh</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>PDMCI_rh</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>-4.0378</td>
      <td>138382</td>
      <td>749.67</td>
      <td>30.1</td>
      <td>43.1</td>
      <td>16.9</td>
      <td>0.00040</td>
      <td>0.00000</td>
      <td>0.00080</td>
      <td>1129</td>
      <td>-2223.62</td>
      <td>rostralmiddlefrontal</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PDnonMCI_lh</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>4</th>
      <td>PDnonMCI_rh</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>5</th>
      <td>PDall_lh</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>3.4012</td>
      <td>161438</td>
      <td>592.67</td>
      <td>-53.3</td>
      <td>-20.1</td>
      <td>-33.1</td>
      <td>0.01772</td>
      <td>0.01534</td>
      <td>0.02010</td>
      <td>876</td>
      <td>1635.12</td>
      <td>inferiortemporal</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2</td>
      <td>2.5887</td>
      <td>138009</td>
      <td>523.77</td>
      <td>-24.4</td>
      <td>-16.8</td>
      <td>64.5</td>
      <td>0.04058</td>
      <td>0.03705</td>
      <td>0.04410</td>
      <td>1206</td>
      <td>2085.15</td>
      <td>precentral</td>
    </tr>
    <tr>
      <th>8</th>
      <td>PDall_rh</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Correlation between rate of change of cortical thickness and the Montreal Cognitive Assessment scores in PD-MCI group</p>
<img src="images/img_corr_PDMCI_rh.jpg"/>
<p>Correlation between rate of change of cortical thickness and the Montreal Cognitive Assessment scores in PD-all group</p>
<img src="images/img_corr_PDall_lh.jpg"/>
</section>
<section id="group-differences">
<h2>group differences<a class="headerlink" href="#group-differences" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># group differences</span>

<span class="n">result_group</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;result_group.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

<span class="c1"># print(&quot;Group analysis\n&quot;)</span>
<span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PDMCI_PDnonMCI&quot;</span><span class="p">,</span> <span class="s2">&quot;PDMCI_HC&quot;</span><span class="p">,</span> <span class="s2">&quot;PDnonMCI_HC&quot;</span><span class="p">]:</span>
    <span class="c1"># print(&quot;** Significant group differences between {pair} **\n&quot;.format(pair=pair))</span>
    <span class="k">for</span> <span class="n">hemi</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;lh&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">]:</span>
        <span class="c1"># print(&quot;Hemisphere {hemi}\n&quot;.format(hemi=hemi))</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
            <span class="s2">&quot;results_group_</span><span class="si">{hemi}</span><span class="s2">/con_group_</span><span class="si">{pair}</span><span class="s2">/cache.th13.abs.sig.cluster.summary&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">hemi</span><span class="o">=</span><span class="n">hemi</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="n">pair</span>
            <span class="p">),</span>
            <span class="s2">&quot;r&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">always_print</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">result_group</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pair</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">hemi</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">always_print</span> <span class="ow">or</span> <span class="s2">&quot;ClusterNo&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="c1"># print(line)</span>
                <span class="n">result_group</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">always_print</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_group</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;result_group.txt&quot;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">s+&quot;</span><span class="p">,</span>
    <span class="n">keep_default_na</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">na_values</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;ClusterNo&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Max&quot;</span><span class="p">,</span>
        <span class="s2">&quot;VtxMax&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Size(mm^2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MNIX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MNIY&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MNIZ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CWP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CWPLow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CWPHi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NVtxs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WghtVtx&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Annot&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">results_group</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ClusterNo</th>
      <th>Max</th>
      <th>VtxMax</th>
      <th>Size(mm^2)</th>
      <th>MNIX</th>
      <th>MNIY</th>
      <th>MNIZ</th>
      <th>CWP</th>
      <th>CWPLow</th>
      <th>CWPHi</th>
      <th>NVtxs</th>
      <th>WghtVtx</th>
      <th>Annot</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>PDMCI_PDnonMCI_lh</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2.8711</td>
      <td>67258</td>
      <td>901.62</td>
      <td>-15.4</td>
      <td>-45.2</td>
      <td>65.8</td>
      <td>0.00040</td>
      <td>0.00000</td>
      <td>0.00080</td>
      <td>2169</td>
      <td>4071.31</td>
      <td>precuneus</td>
    </tr>
    <tr>
      <th>2</th>
      <td>PDMCI_PDnonMCI_rh</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>-4.3574</td>
      <td>34834</td>
      <td>808.31</td>
      <td>45.0</td>
      <td>-4.9</td>
      <td>49.8</td>
      <td>0.00260</td>
      <td>0.00180</td>
      <td>0.00360</td>
      <td>1540</td>
      <td>-3489.04</td>
      <td>precentral</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>-4.2850</td>
      <td>679</td>
      <td>689.83</td>
      <td>36.1</td>
      <td>-16.4</td>
      <td>-3.4</td>
      <td>0.00659</td>
      <td>0.00519</td>
      <td>0.00798</td>
      <td>1752</td>
      <td>-3804.45</td>
      <td>insula</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>-4.7243</td>
      <td>120680</td>
      <td>636.56</td>
      <td>42.1</td>
      <td>7.1</td>
      <td>-37.1</td>
      <td>0.01077</td>
      <td>0.00898</td>
      <td>0.01256</td>
      <td>1030</td>
      <td>-2140.64</td>
      <td>middletemporal</td>
    </tr>
    <tr>
      <th>6</th>
      <td>PDMCI_HC_lh</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>7</th>
      <td>1</td>
      <td>3.4112</td>
      <td>109333</td>
      <td>1596.42</td>
      <td>-12.2</td>
      <td>-55.4</td>
      <td>59.9</td>
      <td>0.00020</td>
      <td>0.00000</td>
      <td>0.00040</td>
      <td>3613</td>
      <td>7252.89</td>
      <td>superiorparietal</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2</td>
      <td>4.2357</td>
      <td>103723</td>
      <td>816.25</td>
      <td>-8.3</td>
      <td>35.1</td>
      <td>34.0</td>
      <td>0.00060</td>
      <td>0.00020</td>
      <td>0.00100</td>
      <td>1259</td>
      <td>2412.37</td>
      <td>superiorfrontal</td>
    </tr>
    <tr>
      <th>9</th>
      <td>PDMCI_HC_rh</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>10</th>
      <td>1</td>
      <td>2.4693</td>
      <td>137873</td>
      <td>619.04</td>
      <td>15.0</td>
      <td>-12.2</td>
      <td>61.8</td>
      <td>0.01435</td>
      <td>0.01216</td>
      <td>0.01653</td>
      <td>1396</td>
      <td>2247.74</td>
      <td>precentral</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2</td>
      <td>3.0369</td>
      <td>151977</td>
      <td>578.61</td>
      <td>37.3</td>
      <td>-29.7</td>
      <td>39.5</td>
      <td>0.02208</td>
      <td>0.01950</td>
      <td>0.02484</td>
      <td>1561</td>
      <td>2734.26</td>
      <td>supramarginal</td>
    </tr>
    <tr>
      <th>12</th>
      <td>3</td>
      <td>3.9183</td>
      <td>2591</td>
      <td>563.81</td>
      <td>29.5</td>
      <td>-48.4</td>
      <td>42.7</td>
      <td>0.02563</td>
      <td>0.02287</td>
      <td>0.02859</td>
      <td>1354</td>
      <td>2888.27</td>
      <td>superiorparietal</td>
    </tr>
    <tr>
      <th>13</th>
      <td>PDnonMCI_HC_lh</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>14</th>
      <td>PDnonMCI_HC_rh</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>15</th>
      <td>1</td>
      <td>4.4171</td>
      <td>109273</td>
      <td>1010.34</td>
      <td>35.7</td>
      <td>-30.6</td>
      <td>39.6</td>
      <td>0.00020</td>
      <td>0.00000</td>
      <td>0.00040</td>
      <td>2607</td>
      <td>5628.62</td>
      <td>supramarginal</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2</td>
      <td>3.8495</td>
      <td>54008</td>
      <td>580.49</td>
      <td>43.5</td>
      <td>-9.4</td>
      <td>46.2</td>
      <td>0.02109</td>
      <td>0.01851</td>
      <td>0.02366</td>
      <td>1391</td>
      <td>2904.78</td>
      <td>precentral</td>
    </tr>
    <tr>
      <th>17</th>
      <td>3</td>
      <td>3.6102</td>
      <td>116416</td>
      <td>537.11</td>
      <td>8.6</td>
      <td>-71.2</td>
      <td>40.0</td>
      <td>0.03842</td>
      <td>0.03489</td>
      <td>0.04195</td>
      <td>996</td>
      <td>1920.65</td>
      <td>precuneus</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="rate-of-change-of-cortical-thickness-in-patients-with-parkinsons-disease">
<h3>Rate of change of cortical thickness in patients with Parkinson’s disease.<a class="headerlink" href="#rate-of-change-of-cortical-thickness-in-patients-with-parkinsons-disease" title="Link to this heading">#</a></h3>
<p>PD-MCI versus PD-non-MCI, left hemisphere</p>
<img src="images/img_group_PDMCI_PDnonMCI_lh.jpg"/>
<img src="images/img_group_PDMCI_PDnonMCI_lh_mid.jpg"/>
<p>PD-MCI versus PD-non-MCI, right hemisphere</p>
<img src="images/img_group_PDnonMCI_PDMCI_rh.jpg"/>
<p>PD-MCI versus HC, left hemisphere</p>
<img src="images/img_group_PDMCI_HC_lh_mid.jpg"/>
<p>PD-MCI versus HC, right hemisphere</p>
<img src="images/img_group_PDMCI_HC_rh.jpg"/>
<p>PD-non-MCI versus HC, right hemisphere</p>
<img src="images/img_group_PDNonMCI_HC_rh.jpg"/>
<img src="images/img_group_PDNonMCI_HC_rh_mid.jpg"/></section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./replications/hanganu-etal-2014"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="README.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Replication of [A. Hanganu et al., 2014]</p>
      </div>
    </a>
    <a class="right-next"
       href="../mak-etal-2015/README.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Replication of [E. Mak et al., 2015]</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Replication: Hanganu <em>et al.</em>, 2014</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-setup">Initial setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ppmi-cohort-preparation">PPMI cohort preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#study-data-download">Study data download</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inclusion-criteria">Inclusion criteria</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exclusion-criteria">Exclusion criteria</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#group-matching">Group matching</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-aggregation">Data aggregation</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pair-visits">Pair visits</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#select-healthy-controls">Select healthy controls</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-aggregation-for-pd">Data aggregation for PD</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-available-visit-pairs-pd-meeting-all-the-criteria">Number of available visit pairs - PD meeting all the criteria</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#select-pd-mci-patients">Select PD-MCI patients</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#select-pd-non-mci-patients">Select PD-non-MCI patients</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Group matching</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-statistics">Descriptive statistics</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#get-mri-data">Get MRI data</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#image-preprocessing">Image preprocessing</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-pipeline-by-hanganu-et-al">Preprocessing pipeline by Hanganu et al.</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-step-1-cross-sectional">preprocessing step 1 - cross-sectional</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-step-2-base-template">preprocessing step 2 - base template</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-step-3-longitudinally-processed-timepoints">preprocessing step 3 - longitudinally processed timepoints</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing-step-4-qcache">preprocessing step 4 - Qcache</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#image-quality-control">Image quality control</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#axial">Axial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coronal">Coronal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sagittal">Sagittal</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#postprocessing">Postprocessing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#roi-analysis">ROI analysis</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vertex-wise-analysis">Vertex-wise analysis</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-the-vertex-data-with-long-mris-slopes-for-longitudinal-two-stage-model">Prepare the vertex data with long_mris_slopes for longitudinal two stage model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-fsgd-file-for-the-correlational-analysis">Create FSGD file for the correlational analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stack-images-for-correlational-analyses">Stack images for correlational analyses</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-fsgd-file-for-the-group-analysis">Create FSGD file for the group analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stack-images-for-group-analyses">Stack images for group analyses</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-glm-model-for-the-correlational-analysis">Run GLM model for the correlational analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-glm-model-for-the-group-analysis">Run GLM model for the group analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#correction-for-multiple-comparison-with-mri-glmfit-sim">Correction for multiple comparison (with mri_glmfit-sim)</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vertex-wise-results">Vertex-wise results</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation-with-moca">correlation with MoCA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#group-differences">group differences</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rate-of-change-of-cortical-thickness-in-patients-with-parkinsons-disease">Rate of change of cortical thickness in patients with Parkinson’s disease.</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The LivingPark Project
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>